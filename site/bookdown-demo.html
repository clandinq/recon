<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>R for Economists</title>
  <meta name="description" content="A short programming guide for economics research." />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="R for Economists" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A short programming guide for economics research." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R for Economists" />
  
  <meta name="twitter:description" content="A short programming guide for economics research." />
  

<meta name="author" content="César Landín" />


<meta name="date" content="2023-07-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">R for Economists</h1>
<p class="author"><em>César Landín</em></p>
<p class="date"><em>2023-07-10</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#introduction" id="toc-introduction"><span class="toc-section-number">1</span> Introduction</a>
<ul>
<li><a href="#contents" id="toc-contents"><span class="toc-section-number">1.1</span> Contents</a></li>
</ul></li>
<li><a href="#figures" id="toc-figures"><span class="toc-section-number">2</span> Figures</a>
<ul>
<li><a href="#plot-margins" id="toc-plot-margins"><span class="toc-section-number">2.1</span> Plot margins</a>
<ul>
<li><a href="#removing-white-space-around-the-plot" id="toc-removing-white-space-around-the-plot"><span class="toc-section-number">2.1.1</span> Removing white space around the plot</a></li>
<li><a href="#removing-white-space-between-axes-and-plot" id="toc-removing-white-space-between-axes-and-plot"><span class="toc-section-number">2.1.2</span> Removing white space between axes and plot</a></li>
</ul></li>
<li><a href="#axis-labels" id="toc-axis-labels"><span class="toc-section-number">2.2</span> Axis labels</a>
<ul>
<li><a href="#removing-axis-labels" id="toc-removing-axis-labels"><span class="toc-section-number">2.2.1</span> Removing axis labels</a></li>
</ul></li>
<li><a href="#legends" id="toc-legends"><span class="toc-section-number">2.3</span> Legends</a>
<ul>
<li><a href="#removing-the-legend-title" id="toc-removing-the-legend-title"><span class="toc-section-number">2.3.1</span> Removing the legend title</a></li>
<li><a href="#removing-black-boxes-around-legend-keys" id="toc-removing-black-boxes-around-legend-keys"><span class="toc-section-number">2.3.2</span> Removing black boxes around legend keys</a></li>
<li><a href="#putting-the-legend-inside-the-figure" id="toc-putting-the-legend-inside-the-figure"><span class="toc-section-number">2.3.3</span> Putting the legend inside the figure</a></li>
</ul></li>
<li><a href="#number-formatting-functions" id="toc-number-formatting-functions"><span class="toc-section-number">2.4</span> Number formatting functions</a>
<ul>
<li><a href="#calculating-the-mean-median-and-standard-deviation-of-a-variable" id="toc-calculating-the-mean-median-and-standard-deviation-of-a-variable"><span class="toc-section-number">2.4.1</span> Calculating the mean, median and standard deviation of a variable</a></li>
<li><a href="#checking-if-a-number-is-an-integer." id="toc-checking-if-a-number-is-an-integer."><span class="toc-section-number">2.4.2</span> Checking if a number is an integer.</a></li>
<li><a href="#number-formatting-function" id="toc-number-formatting-function"><span class="toc-section-number">2.4.3</span> Number formatting function</a></li>
</ul></li>
<li><a href="#multiplot-figures" id="toc-multiplot-figures"><span class="toc-section-number">2.5</span> Multiplot figures</a>
<ul>
<li><a href="#auxiliary-functions-to-remove-figure-components-axes-legend" id="toc-auxiliary-functions-to-remove-figure-components-axes-legend"><span class="toc-section-number">2.5.1</span> Auxiliary functions to remove figure components: axes, legend</a></li>
</ul></li>
</ul></li>
<li><a href="#tables" id="toc-tables"><span class="toc-section-number">3</span> Tables</a>
<ul>
<li><a href="#guidelines-for-table-formatting" id="toc-guidelines-for-table-formatting"><span class="toc-section-number">3.1</span> Guidelines for table formatting</a>
<ul>
<li><a href="#horizontal-and-vertical-lines" id="toc-horizontal-and-vertical-lines"><span class="toc-section-number">3.1.1</span> Horizontal and vertical lines</a></li>
<li><a href="#column-headings" id="toc-column-headings"><span class="toc-section-number">3.1.2</span> Column headings</a></li>
<li><a href="#symbols" id="toc-symbols"><span class="toc-section-number">3.1.3</span> Symbols</a></li>
</ul></li>
<li><a href="#an-example-using-the-iris-dataset" id="toc-an-example-using-the-iris-dataset"><span class="toc-section-number">3.2</span> An example using the <code>iris</code> dataset</a>
<ul>
<li><a href="#two-simple-models-using-the-iris-dataset" id="toc-two-simple-models-using-the-iris-dataset"><span class="toc-section-number">3.2.1</span> Two simple models using the <code>iris</code> dataset</a></li>
</ul></li>
<li><a href="#adjusting-table-size-and-position" id="toc-adjusting-table-size-and-position"><span class="toc-section-number">3.3</span> Adjusting table size and position</a></li>
<li><a href="#updating-variable-names-and-adding-a-caption-and-label" id="toc-updating-variable-names-and-adding-a-caption-and-label"><span class="toc-section-number">3.4</span> Updating variable names and adding a caption and label</a>
<ul>
<li><a href="#updating-independent-variable-names" id="toc-updating-independent-variable-names"><span class="toc-section-number">3.4.1</span> Updating independent variable names</a></li>
<li><a href="#adding-dependent-variable-names-and-model-numbers" id="toc-adding-dependent-variable-names-and-model-numbers"><span class="toc-section-number">3.4.2</span> Adding dependent variable names and model numbers</a></li>
<li><a href="#adding-a-multicolumn-title" id="toc-adding-a-multicolumn-title"><span class="toc-section-number">3.4.3</span> Adding a multicolumn title</a></li>
<li><a href="#adding-a-caption-and-title-to-the-table" id="toc-adding-a-caption-and-title-to-the-table"><span class="toc-section-number">3.4.4</span> Adding a caption and title to the table</a></li>
</ul></li>
<li><a href="#final-table-formatting" id="toc-final-table-formatting"><span class="toc-section-number">3.5</span> Final table formatting</a>
<ul>
<li><a href="#updating-the-number-of-observations" id="toc-updating-the-number-of-observations"><span class="toc-section-number">3.5.1</span> Updating the number of observations</a></li>
<li><a href="#inserting-additional-data-rows" id="toc-inserting-additional-data-rows"><span class="toc-section-number">3.5.2</span> Inserting additional data rows</a></li>
<li><a href="#distributing-coefficient-names-over-two-rows" id="toc-distributing-coefficient-names-over-two-rows"><span class="toc-section-number">3.5.3</span> Distributing coefficient names over two rows</a></li>
<li><a href="#inserting-space-between-variables" id="toc-inserting-space-between-variables"><span class="toc-section-number">3.5.4</span> Inserting space between variables</a></li>
</ul></li>
<li><a href="#putting-it-all-together" id="toc-putting-it-all-together"><span class="toc-section-number">3.6</span> Putting it all together</a>
<ul>
<li><a href="#combining-everything-into-one-simple-function" id="toc-combining-everything-into-one-simple-function"><span class="toc-section-number">3.6.1</span> Combining everything into one simple function</a></li>
<li><a href="#adding-footnotes" id="toc-adding-footnotes"><span class="toc-section-number">3.6.2</span> Adding footnotes</a></li>
</ul></li>
<li><a href="#preparing-tables-for-presentations" id="toc-preparing-tables-for-presentations"><span class="toc-section-number">3.7</span> Preparing tables for presentations</a>
<ul>
<li><a href="#generating-presentation-versions-of-tables" id="toc-generating-presentation-versions-of-tables"><span class="toc-section-number">3.7.1</span> Generating presentation versions of tables</a></li>
<li><a href="#removing-standard-errors-and-column-numbers" id="toc-removing-standard-errors-and-column-numbers"><span class="toc-section-number">3.7.2</span> Removing standard errors and column numbers</a></li>
<li><a href="#adding-notes" id="toc-adding-notes"><span class="toc-section-number">3.7.3</span> Adding notes</a></li>
</ul></li>
</ul></li>
<li><a href="#statistical-tests" id="toc-statistical-tests"><span class="toc-section-number">4</span> Statistical tests</a>
<ul>
<li><a href="#easy-two-sided-hypothesis-tests-in-r" id="toc-easy-two-sided-hypothesis-tests-in-r"><span class="toc-section-number">4.1</span> Easy two-sided hypothesis tests in R</a></li>
</ul></li>
<li><a href="#geographic-place-matching" id="toc-geographic-place-matching"><span class="toc-section-number">5</span> Geographic place matching</a>
<ul>
<li><a href="#google-places-api-searches" id="toc-google-places-api-searches"><span class="toc-section-number">5.1</span> Google Places API searches</a></li>
</ul></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for Economists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="introduction" class="section level1 hasAnchor" number="1">
<h1 class="hasAnchor"><span class="header-section-number">1</span> Introduction<a href="#introduction" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="contents" class="section level2 hasAnchor" number="1.1">
<h2 class="hasAnchor"><span class="header-section-number">1.1</span> Contents<a href="#contents" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><a href="https://clandinq.github.io/recon/index.html">1. Introduction</a> introduces the guide and how to get started using it.</li>
<li><a href="https://clandinq.github.io/recon/figures.html">2. Figures</a> describes tips for using ggplot to generate publication-quality graphs.</li>
<li><a href="https://clandinq.github.io/recon/tables.html">3. Tables</a> introduces best practices for the presentation of tables in economics papers and explains the usage of functions that can generate formatted tables from R model objects.</li>
<li><a href="https://clandinq.github.io/recon/statistical-tests.html">4. Statistical Tests</a> explains how to perform hypothesis tests on model coefficients.</li>
<li><a href="https://clandinq.github.io/recon/geographic-place-matching.html">5. Geographic Place Matching</a> explains how to match addresses to coordinates using Google Place API searches.</li>
</ul>
<!-- # Prerequisites -->
<!-- This is a _sample_ book written in **Markdown**. You can use anything that Pandoc's Markdown supports, e.g., a math equation $a^2 + b^2 = c^2$. -->
<!-- The **bookdown** package can be installed from CRAN or Github: -->
<!-- ```{r eval=FALSE} -->
<!-- install.packages("bookdown") -->
<!-- # or the development version -->
<!-- # devtools::install_github("rstudio/bookdown") -->
<!-- ``` -->
<!-- Remember each Rmd file contains one and only one chapter, and a chapter is defined by the first-level heading `#`. -->
<!-- To compile this example to PDF, you need XeLaTeX. You are recommended to install TinyTeX (which includes XeLaTeX): <https://yihui.name/tinytex/>. -->
<!-- ```{r include=FALSE} -->
<!-- # automatically create a bib database for R packages -->
<!-- knitr::write_bib(c( -->
<!--   .packages(), "bookdown", "knitr", "rmarkdown" -->
<!-- ), "packages.bib") -->
<!-- ``` -->
<!--chapter:end:index.Rmd-->
</div>
</div>
<div id="figures" class="section level1 hasAnchor" number="2">
<h1 class="hasAnchor"><span class="header-section-number">2</span> Figures<a href="#figures" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Tips for using <code>ggplot</code> to generate publication-quality graphs {#ggplot}</p>
<!-- Figures -->
<!-- - Sans-serif fonts such as Arial and Helvetica should be used whenever possible. Package `ggplot2` uses Arial as the default font. -->
<!-- - Multi-panel figures should include panel subtitles (e.g. Panel A: Intent to Treat). -->
<!-- - Figures should always include legends explaining the colors and symbols used.  -->
<!-- Distinguishing color in figures -->
<!-- - Multiple shades of color -->
<!-- - Line graphs: include different keys. -->
<!-- - Grouped bar graphs: include patterned fills. -->
<!-- If images require multiple lines, choose keys and line types that are easily distinguished from each other (give example). -->
<!-- Figure files should be in EPS format. -->
<!-- You can label chapter and section titles using `{#label}` after them, e.g., we can reference Chapter \@ref(intro). If you do not manually label them, there will be automatic labels anyway, e.g., Chapter \@ref(methods). -->
<!-- Reference a figure by its code chunk label with the `fig:` prefix, e.g., see Figure \@ref(fig:nice-fig). Similarly, you can reference tables generated from `knitr::kable()`, e.g., see Table \@ref(tab:nice-tab). -->
<!-- Figures and tables with captions will be placed in `figure` and `table` environments, respectively. -->
<!-- # ```{r nice-fig, fig.cap='Here is a nice figure!', out.width='80%', fig.asp=.75, fig.align='center'} -->
<!-- https://bookdown.org/yihui/bookdown-demo/intro.html -->
<!-- https://bookdown.org/yihui/bookdown/preview-a-chapter.html -->
<!-- bookdown::render_book(here("scripts", "book")) -->
<div id="plot-margins" class="section level2 hasAnchor" number="2.1">
<h2 class="hasAnchor"><span class="header-section-number">2.1</span> Plot margins<a href="#plot-margins" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="removing-white-space-around-the-plot" class="section level3 hasAnchor" number="2.1.1">
<h3 class="hasAnchor"><span class="header-section-number">2.1.1</span> Removing white space around the plot<a href="#removing-white-space-around-the-plot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To remove the white space around the plot, set the plot margins equal to 0. The order is [top, right, bottom, left].</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>figure <span class="sc">%&gt;%</span> </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span></code></pre></div>
<p>This setting is useful when working with package <code>cowplot</code> to generate multi-panel figures. <code>cowplot::plot_grid</code> often overlays panel labels on top of the figures, so you can add space to the top of the figure:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(g1 <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">15</span>)),</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>          g2 <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">15</span>)),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
</div>
<div id="removing-white-space-between-axes-and-plot" class="section level3 hasAnchor" number="2.1.2">
<h3 class="hasAnchor"><span class="header-section-number">2.1.2</span> Removing white space between axes and plot<a href="#removing-white-space-between-axes-and-plot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Sometimes it’s useful to reduce the distance between the plot and axis text. You can do this by reducing the top margin of the x-axis text and the right margin of the y-axis text:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>figure <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="sc">-</span><span class="dv">5</span>, <span class="at">r =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">0</span>, <span class="at">l =</span> <span class="dv">0</span>)),</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">0</span>, <span class="at">r =</span> <span class="sc">-</span><span class="dv">5</span>, <span class="at">b =</span> <span class="dv">0</span>, <span class="at">l =</span> <span class="dv">0</span>)))</span></code></pre></div>
</div>
</div>
<div id="axis-labels" class="section level2 hasAnchor" number="2.2">
<h2 class="hasAnchor"><span class="header-section-number">2.2</span> Axis labels<a href="#axis-labels" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="removing-axis-labels" class="section level3 hasAnchor" number="2.2.1">
<h3 class="hasAnchor"><span class="header-section-number">2.2.1</span> Removing axis labels<a href="#removing-axis-labels" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When removing axis labels (for example, when dealing with dates in the x-axis), use <code>labs(x = NULL)</code> rather than <code>labs(x = "")</code>, as this eliminates the extra white space.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>figure <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>)</span></code></pre></div>
</div>
</div>
<div id="legends" class="section level2 hasAnchor" number="2.3">
<h2 class="hasAnchor"><span class="header-section-number">2.3</span> Legends<a href="#legends" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="removing-the-legend-title" class="section level3 hasAnchor" number="2.3.1">
<h3 class="hasAnchor"><span class="header-section-number">2.3.1</span> Removing the legend title<a href="#removing-the-legend-title" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Legend titles are always redundant: if the figure is included in the paper or report, then the title and axis label give enough information; if the figure is in a presentation, the slide title and description along with axis labels provide enough information to understand what is being plotted.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>figure <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
</div>
<div id="removing-black-boxes-around-legend-keys" class="section level3 hasAnchor" number="2.3.2">
<h3 class="hasAnchor"><span class="header-section-number">2.3.2</span> Removing black boxes around legend keys<a href="#removing-black-boxes-around-legend-keys" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Legend keys look much better without the black border surrounding them. This should be a standard for any figure.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>figure <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.key =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
</div>
<div id="putting-the-legend-inside-the-figure" class="section level3 hasAnchor" number="2.3.3">
<h3 class="hasAnchor"><span class="header-section-number">2.3.3</span> Putting the legend inside the figure<a href="#putting-the-legend-inside-the-figure" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Useful for when there is a lot of blank space in the figure.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>figure <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">0.85</span>))</span></code></pre></div>
<!-- # Center ggplot title -->
<!-- theme(plot.title = element_text(hjust = 0.5)) -->
<!-- ### -->
<!-- # (4.7): Merge missing municipalities with shapefiles. # -->
<!-- shp_mun <- st_read(here("proc", "shapefiles", "shp_mun.shp")) -->
<!-- missing_coords_shp <- mun_coords  %>%  -->
<!--   st_as_sf(coords = c("loc_lon", "loc_lat")) %>%  -->
<!--   st_set_crs(8999) -->
<!-- intersections <- tibble(cve_total = st_intersects(missing_coords_shp, shp_mun) %>% unlist(), -->
<!--                         cve_ent = shp_mun$cve_ent[cve_total], -->
<!--                         cve_mun_2020 = shp_mun$cve_mun[cve_total], -->
<!--                         mun_id = mun_coords$mun_id) %>%  -->
<!--   select(-cve_total) %>%  -->
<!--   left_join(mun_coords, by = "mun_id") -->
<!-- missing_muns_l %<>%  -->
<!--   left_join(intersections %>% select(-loc_lat, -loc_lon),  -->
<!--             by = c("cve_ent", "mun_id")) -->
<!-- rm(intersections, mun_coords, missing_coords_shp, key) -->
</div>
</div>
<div id="number-formatting-functions" class="section level2 hasAnchor" number="2.4">
<h2 class="hasAnchor"><span class="header-section-number">2.4</span> Number formatting functions<a href="#number-formatting-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You can save these functions in a script called number_functions.R and import them in each script where they’re needed, e.g.:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">&quot;scripts&quot;</span>, <span class="st">&quot;programs&quot;</span>, <span class="st">&quot;number_functions.R&quot;</span>))</span></code></pre></div>
<div id="calculating-the-mean-median-and-standard-deviation-of-a-variable" class="section level3 hasAnchor" number="2.4.1">
<h3 class="hasAnchor"><span class="header-section-number">2.4.1</span> Calculating the mean, median and standard deviation of a variable<a href="#calculating-the-mean-median-and-standard-deviation-of-a-variable" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>num_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(df, variable, <span class="at">dig =</span> <span class="dv">1</span>) {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(<span class="fu">eval</span>(<span class="fu">as.name</span>(variable))) <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="at">digits =</span> dig)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Median</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>num_median <span class="ot">&lt;-</span> <span class="cf">function</span>(df, variable, <span class="at">dig =</span> <span class="dv">1</span>) {</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(<span class="fu">eval</span>(<span class="fu">as.name</span>(variable))) <span class="sc">%&gt;%</span> </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">median</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="at">digits =</span> dig)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard deviation</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>num_sd <span class="ot">&lt;-</span> <span class="cf">function</span>(df, variable, <span class="at">dig =</span> <span class="dv">1</span>) {</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(<span class="fu">eval</span>(<span class="fu">as.name</span>(variable))) <span class="sc">%&gt;%</span> </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sd</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="at">digits =</span> dig)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>You can call these functions the following way:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">num_mean</span>(<span class="st">&quot;number_employees&quot;</span>)</span></code></pre></div>
</div>
<div id="checking-if-a-number-is-an-integer." class="section level3 hasAnchor" number="2.4.2">
<h3 class="hasAnchor"><span class="header-section-number">2.4.2</span> Checking if a number is an integer.<a href="#checking-if-a-number-is-an-integer." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is used in the functions that print numbers to .tex files, since no decimals should be added after integers.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>num_int <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">==</span> <span class="fu">round</span>(x)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="number-formatting-function" class="section level3 hasAnchor" number="2.4.3">
<h3 class="hasAnchor"><span class="header-section-number">2.4.3</span> Number formatting function<a href="#number-formatting-function" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This function formats numbers with a standard number of digits and commas to present large and small numbers in a more readable format.</p>
<p>How does this function work? First, the function calculates the number of digits the number should have to the right of the decimal point. For numbers from 1-9, three digits are assigned, two digits are assigned for numbers 10-99, one for 100-999, and no right digits for numbers equal or larger than 1,000. This function sets the maximum number of right digits as 3. Therefore, 0.0001 will display as 0.000. Once the number of right digits is defined, the number is formatted. Numbers smaller than 1 are padded if necessary to ensure that there are 3 right digits (e.g., 0.25 is formatted as 0.250). The default number of right digits can be overridden with the option <code>override_right_digits</code>.</p>
<p>This function has the same name as <code>scales::comma_format</code>. However, this function has been superseded by <code>scales::label_comma</code>, so there are no issues with this user-defined function taking priority over <code>scales::comma_format</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>comma_format <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">override_right_digits =</span> <span class="cn">NA</span>) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate number of right digits</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x <span class="sc">&lt;=</span> <span class="dv">0</span>) {num <span class="ot">&lt;-</span> <span class="dv">1</span>} <span class="cf">else</span> {num <span class="ot">&lt;-</span> x}</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  right_digits <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">-</span> <span class="fu">floor</span>(<span class="fu">log10</span>(<span class="fu">abs</span>(num)))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (right_digits <span class="sc">&lt;</span> <span class="dv">0</span>) {right_digits <span class="ot">&lt;-</span> <span class="dv">0</span>}</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (right_digits <span class="sc">&gt;</span> <span class="dv">3</span>) {right_digits <span class="ot">&lt;-</span> <span class="dv">3</span>}</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(override_right_digits)) {right_digits <span class="ot">&lt;-</span> override_right_digits}</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate number of left digits</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  left_digits <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="sc">+</span> <span class="fu">floor</span>(<span class="fu">log10</span>(<span class="fu">abs</span>(num)))</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (left_digits <span class="sc">&lt;=</span> <span class="dv">0</span>) {left_digits <span class="ot">&lt;-</span> <span class="dv">1</span>}</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Format number</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  proc_num <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">round</span>(x, right_digits), <span class="at">nsmall =</span> right_digits, <span class="at">digits =</span>  left_digits, <span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (proc_num <span class="sc">!=</span> <span class="st">&quot;0&quot;</span> <span class="sc">&amp;</span> <span class="fu">as.numeric</span>(<span class="fu">str_replace</span>(proc_num, <span class="fu">fixed</span>(<span class="st">&quot;,&quot;</span>), <span class="st">&quot;&quot;</span>)) <span class="sc">&lt;</span> <span class="dv">1</span>) {</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    proc_num <span class="ot">&lt;-</span> <span class="fu">str_pad</span>(proc_num, right_digits <span class="sc">+</span> <span class="dv">2</span>, <span class="st">&quot;right&quot;</span>, <span class="st">&quot;0&quot;</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(proc_num)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Here are a few examples of the output of this function:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">c</span>(<span class="fl">0.098</span>, <span class="fl">0.11</span>, <span class="fl">3.1233</span>, <span class="fl">45.968</span>, <span class="dv">1949</span>), comma_format) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>()</span></code></pre></div>
<pre><code>## [1] &quot;0.098&quot; &quot;0.110&quot; &quot;3.123&quot; &quot;45.97&quot; &quot;1,949&quot;</code></pre>
<!-- # (1.3): Print number to file. -->
<!-- print_n <- function(x, file, note = "", dig = 1) { -->
<!--   # Round number to desired number of digits -->
<!--   current_num <- as.numeric(x) %>% -->
<!--     round(dig) -->
<!--   # Don't add 0 after decimal point if number is a whole number -->
<!--   # https://support.jmir.org/hc/en-us/articles/360019690851-Guidelines-for-Reporting-Statistics -->
<!--   current_num <- ifelse(num_int(current_num), -->
<!--                         comma_format(current_num, override_right_digits = 0), -->
<!--                         comma_format(current_num, override_right_digits = dig)) -->
<!--  # Export number -->
<!--   current_num %>% -->
<!--     print() %>% # prior to adding the % for Latex -->
<!--     str_c("%") %>% # this % is to prevent space after number -->
<!--     str_c(ifelse(note != "", str_c("\n% ", note), "")) %>% -->
<!--     write_(here("results", "numbers", file)) -->
<!-- } -->
<!-- # (1.4): Print percentage to file. -->
<!-- print_pct <- function(x, file, note = "", dig = 1) { -->
<!--   # Round number to desired number of digits -->
<!--   current_num <- as.numeric(x) %>% -->
<!--     "*"(100) %>% -->
<!--     round(dig) -->
<!--   # Don't add 0 after decimal point if percentage is a whole number -->
<!--   # https://support.jmir.org/hc/en-us/articles/360019690851-Guidelines-for-Reporting-Statistics -->
<!--   current_num <- ifelse(num_int(current_num), -->
<!--                         comma_format(current_num, override_right_digits = 0), -->
<!--                         comma_format(current_num, override_right_digits = dig)) -->
<!--   # Export number -->
<!--   current_num %>% -->
<!--     str_c("\\%%") %T>% # this % is to prevent space after number; not the \% in Latex -->
<!--     print() %>% -->
<!--     str_c(ifelse(note != "", str_c("\n% ", note), "")) %>% -->
<!--     write_(here("results", "numbers", file))  # includes the "%" in printing since it's a percent -->
<!-- } -->
<!-- ## Saving numbers as .tex files -->
<!-- When results change, you want numbers to change -->
<!-- Eliminates possibility of manual error -->
<!-- Folder structure should include "results/numbers" and we should include instructions about producing all numbers in a paper as tex files that are included with \input{} -->
<!-- This should be added to the RA Guide. Furthermore, the commands I've written to write these numbers to tex files with the correct formatting (e.g. print_n.R, print_as_percent.R) should be added to the R, Stata, and Python guides. For those guides, @César Landín add to R Guide first then @Anoushka Nalwa to Stata guide and @Jora to Python guide. -->
<!-- Note that when adding them to the guides you should be using command line git, clone the repo, create a new branch, make the changes, push your branch, then on GitHub submit a pull request to incorporate those changes into the main branch. There are some instructions on this in the RA Guide: https://github.com/skhiggins/ra_guide. Just as there are some scripts already included as part of the R, Stata, and Python guides, these scripts to print output to a tex file should also be included within the repo and linked in the guides. -->
</div>
</div>
<div id="multiplot-figures" class="section level2 hasAnchor" number="2.5">
<h2 class="hasAnchor"><span class="header-section-number">2.5</span> Multiplot figures<a href="#multiplot-figures" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="auxiliary-functions-to-remove-figure-components-axes-legend" class="section level3 hasAnchor" number="2.5.1">
<h3 class="hasAnchor"><span class="header-section-number">2.5.1</span> Auxiliary functions to remove figure components: axes, legend<a href="#auxiliary-functions-to-remove-figure-components-axes-legend" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Functions:</strong></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>remove_axis_x <span class="ot">&lt;-</span> <span class="cf">function</span>(plot) {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  plot <span class="sc">+</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>remove_axis_y <span class="ot">&lt;-</span> <span class="cf">function</span>(plot) {</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  plot <span class="sc">+</span> </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>remove_legend <span class="ot">&lt;-</span> <span class="cf">function</span>(plot) {</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  plot <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Usage:</strong>
Let <code>g1</code>, <code>g2</code> and <code>g3</code> be three figures with the same x-axis. We can plot the three figures in one multipanel figure, removing the legend and x-axis from all but the bottom figure.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(g1 <span class="sc">%&gt;%</span> <span class="fu">remove_legend</span>() <span class="sc">%&gt;%</span> <span class="fu">remove_axis_x</span>(), </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>          g2 <span class="sc">%&gt;%</span> <span class="fu">remove_legend</span>() <span class="sc">%&gt;%</span> <span class="fu">remove_axis_x</span>(), </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>          g3, </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">nrow =</span> <span class="dv">3</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis =</span> <span class="st">&quot;b&quot;</span>, </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">align =</span> <span class="st">&quot;h&quot;</span>)</span></code></pre></div>
<!-- An alternative to the previous is to simply remove the axis from the three figures and then incorporate the axis in the bottom fig. -->
<!--chapter:end:01-figures.Rmd-->
</div>
</div>
</div>
<div id="tables" class="section level1 hasAnchor" number="3">
<h1 class="hasAnchor"><span class="header-section-number">3</span> Tables<a href="#tables" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This section introduces best practices for the presentation of tables in economics papers and explains the usage of functions that can generate formatted tables from R model objects. First, we give guidelines for table formatting adapted from the Journal of Political Economy’s <a href="journals.uchicago.edu/journals/jpe/prep-table">manuscript preparation guide</a>. Second, we construct a publication-quality table using custom functions that can be downloaded <a href="https://github.com/clandinq/ra_tools/blob/main/scripts/table_functions.R">here</a>.</p>
<div id="guidelines-for-table-formatting" class="section level2 hasAnchor" number="3.1">
<h2 class="hasAnchor"><span class="header-section-number">3.1</span> Guidelines for table formatting<a href="#guidelines-for-table-formatting" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="horizontal-and-vertical-lines" class="section level3 hasAnchor" number="3.1.1">
<h3 class="hasAnchor"><span class="header-section-number">3.1.1</span> Horizontal and vertical lines<a href="#horizontal-and-vertical-lines" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><strong>Only three horizontal lines.</strong> Tables should be free of horizontal lines unless they indicate the structure of the data. All tables should have the three following horizontal lines:
<ul>
<li>One under the title, above the column headings (LaTeX <code>\toprule</code>)</li>
<li>One between the column headings and the body of the table (LaTeX <code>\midrule</code>)</li>
<li>One at the bottom of the table (LaTeX <code>\bottomrule</code>)</li>
</ul></li>
<li><strong>No vertical lines.</strong> No vertical lines should be included in the table.</li>
</ul>
</div>
<div id="column-headings" class="section level3 hasAnchor" number="3.1.2">
<h3 class="hasAnchor"><span class="header-section-number">3.1.2</span> Column headings<a href="#column-headings" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><strong>Brief column names.</strong> Column headings should identify the column as briefly as possible. Headings should contain any necessary symbols (%, $, etc.) or measurement abbreviations (cm, kg, etc.) that apply to the data in the column below.</li>
</ul>
</div>
<div id="symbols" class="section level3 hasAnchor" number="3.1.3">
<h3 class="hasAnchor"><span class="header-section-number">3.1.3</span> Symbols<a href="#symbols" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p><strong>No symbols in the table body.</strong> The body of the table should be free of symbols or measurement abbreviations (e.g. %, USD).</p></li>
<li><p><strong>Symbols should be included next to dependent variable names.</strong> Symbols should appear in the column head when they apply to all values in the column, or in the leftmost column when they apply to all values in a row.</p>
<ul>
<li>For example, balance tables where each row is a regression will include symbols in row headers; regression tables where each column is a regression will include symbols in column headers.</li>
</ul></li>
</ul>
</div>
</div>
<div id="an-example-using-the-iris-dataset" class="section level2 hasAnchor" number="3.2">
<h2 class="hasAnchor"><span class="header-section-number">3.2</span> An example using the <code>iris</code> dataset<a href="#an-example-using-the-iris-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The following sections show how to make a publication-quality table using the <code>iris</code> dataset.</p>
<div id="two-simple-models-using-the-iris-dataset" class="section level3 hasAnchor" number="3.2.1">
<h3 class="hasAnchor"><span class="header-section-number">3.2.1</span> Two simple models using the <code>iris</code> dataset<a href="#two-simple-models-using-the-iris-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>First, we load the <code>iris</code> dataset that contains measurements of 4 attributes for 50 flowers from 3 different species.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(here, tidyverse, magrittr, fixest, modelsummary, kableExtra, scales)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(iris)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris)</span></code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa
## 4          4.6         3.1          1.5         0.2  setosa
## 5          5.0         3.6          1.4         0.2  setosa
## 6          5.4         3.9          1.7         0.4  setosa</code></pre>
<p>Then, we define two models using package <code>fixest</code>. Both contain species fixed effects and cluster their errors at the species level.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">feols</span>(Petal.Width <span class="sc">~</span> Sepal.Length,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">fixef =</span> <span class="st">&quot;Species&quot;</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">cluster =</span> <span class="st">&quot;Species&quot;</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> iris)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">feols</span>(Petal.Width <span class="sc">~</span> Sepal.Length <span class="sc">+</span> Sepal.Width, </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">fixef =</span> <span class="st">&quot;Species&quot;</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">cluster =</span> <span class="st">&quot;Species&quot;</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> iris)</span></code></pre></div>
<div id="mshow-visualizing-quickly-regression-outcomes" class="section level4 hasAnchor" number="3.2.1.1">
<h4 class="hasAnchor"><span class="header-section-number">3.2.1.1</span> <code>mshow</code>: <strong>visualizing quickly regression outcomes</strong><a href="#mshow-visualizing-quickly-regression-outcomes" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Next, we introduce a function called <strong>mshow</strong> for visualizing quickly regression outcomes. This function is helpful when we want to quickly preview a model in R Studio’s Viewer window instead of having to export the model to LaTeX. <strong>mshow</strong> defines standard significance levels and omits all statistics but the number of observations. The function takes as an input a list with the models (or a single model), and can include additional input that is passed on to the <code>modelsummary</code> function (for example, including additional rows).</p>
<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Model 1
</th>
<th style="text-align:center;">
Model 2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Sepal.Length
</td>
<td style="text-align:center;">
0.145**
</td>
<td style="text-align:center;">
0.064
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.033)
</td>
<td style="text-align:center;">
(0.034)
</td>
</tr>
<tr>
<td style="text-align:left;">
Sepal.Width
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.232
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
(0.146)
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
150
</td>
<td style="text-align:center;">
150
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup></sup> * p &lt; 0.1, ** p &lt; 0.05, *** p &lt; 0.01
</td>
</tr>
</tfoot>
</table>
</div>
<div id="exporting-the-table-to-latex" class="section level4 hasAnchor" number="3.2.1.2">
<h4 class="hasAnchor"><span class="header-section-number">3.2.1.2</span> Exporting the table to LaTeX<a href="#exporting-the-table-to-latex" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can export the previous table to latex with the following code:</p>
<center>
<img src="https://raw.githubusercontent.com/clandinq/recon/main/results/tables/table_1.jpg" width="300" />
</center>
<p>The previous table is far from being ready to include in a paper: it does not specify what the outcome variable is, the default variable names have not been replaced by more descriptive names, and it includes content that is better left for the footnote (significance notes). The next thing that should be done to format the table is to adjust the table size and position, since both of these issues are fixed earlier on in the LaTeX code.</p>
</div>
</div>
</div>
<div id="adjusting-table-size-and-position" class="section level2 hasAnchor" number="3.3">
<h2 class="hasAnchor"><span class="header-section-number">3.3</span> Adjusting table size and position<a href="#adjusting-table-size-and-position" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The functions <code>float_here</code>, <code>adjust_box</code>, <code>adjust_height</code>, and <code>adjust_col_spacing</code> are used to adjust the table size and position:</p>
<ul>
<li><code>float_here</code> inserts the <code>[H]</code> option after <code>\begin{table}</code> so that LaTeX does not reposition the tables. This function requires including <code>\usepackage{float}</code> in the document preamble.</li>
<li><code>adjust_box</code> reduces the size of the table so that it fits within the text column width. This function requires including <code>\usepackage{adjustbox}</code> in the document preamble.</li>
<li><code>adjust_height</code> is used to adjust the <em>height</em> of a table. This is useful when dealing with long tables that may not fit within the same page without further adjustment. This limits the table to a user-defined text height percentage (e.g. 70% of the text height). <code>adjust_height</code> requires the previous application of the <code>adjust_box</code> function.</li>
<li><code>str_insert</code> is an auxiliary function used to insert lines in tables.</li>
<li><code>adjust_col_spacing</code> defines column spacings. This can be used to increase the spacing between columns when a table looks cramped.</li>
</ul>
<p><strong>Functions</strong>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>float_here <span class="ot">&lt;-</span> <span class="cf">function</span>(table) {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">suppressWarnings</span>(<span class="fu">str_detect</span>(<span class="at">string =</span> table, </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">pattern =</span> <span class="fu">fixed</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">begin{table}[H]&quot;</span>)))) {</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    table <span class="sc">%&lt;&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_replace</span>(<span class="at">pattern =</span> <span class="fu">fixed</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">begin{table}&quot;</span>), </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">replacement =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">begin{table}[H]&quot;</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(table)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>adjust_box <span class="ot">&lt;-</span> <span class="cf">function</span>(table) {</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  table <span class="sc">%&gt;%</span> </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace</span>(<span class="at">pattern =</span> <span class="fu">fixed</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">begin{tabular&quot;</span>),</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">replacement =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">adjustbox{max width=</span><span class="sc">\\</span><span class="st">textwidth}{ </span><span class="sc">\n</span><span class="st"> </span><span class="sc">\\</span><span class="st">begin{tabular&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace</span>(<span class="at">pattern =</span> <span class="fu">fixed</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">end{tabular}&quot;</span>),</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">replacement =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">end{tabular}}&quot;</span>)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>adjust_height <span class="ot">&lt;-</span> <span class="cf">function</span>(table, height) {</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  table <span class="sc">%&gt;%</span> </span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace</span>(<span class="at">pattern =</span> <span class="fu">fixed</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">adjustbox{max width=</span><span class="sc">\\</span><span class="st">textwidth}&quot;</span>),</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>                <span class="at">replacement =</span> <span class="fu">str_c</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">adjustbox{max totalheight=&quot;</span>, height, </span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;</span><span class="sc">\\</span><span class="st">textheight, max width=</span><span class="sc">\\</span><span class="st">textwidth}&quot;</span>))</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>str_insert <span class="ot">&lt;-</span> <span class="cf">function</span>(table, pattern, insert, <span class="at">before =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>  rep <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(before,</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>                <span class="fu">str_c</span>(<span class="fu">fixed</span>(insert), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="fu">fixed</span>(pattern)),</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>                <span class="fu">str_c</span>(<span class="fu">fixed</span>(pattern), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="fu">fixed</span>(insert)))</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  table <span class="sc">%&gt;%</span> </span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace</span>(<span class="at">pattern =</span> <span class="fu">fixed</span>(pattern),</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>                <span class="at">replacement =</span> rep)</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>adjust_col_spacing <span class="ot">&lt;-</span> <span class="cf">function</span>(table, spacing) {</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>  table <span class="sc">%&gt;%</span> </span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_insert</span>(<span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">centering&quot;</span>,</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>               <span class="at">insert =</span> <span class="fu">str_c</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">setlength{</span><span class="sc">\\</span><span class="st">tabcolsep}{&quot;</span>, spacing, <span class="st">&quot;pt}&quot;</span>))</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Usage</strong>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>current_table <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">float_here</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adjust_box</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adjust_height</span>(<span class="fl">0.7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adjust_col_spacing</span>(<span class="dv">16</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write</span>(<span class="fu">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;tables&quot;</span>, <span class="st">&quot;table_2.tex&quot;</span>))</span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/clandinq/recon/main/results/tables/table_2.jpg" width="389" />
</center>
<p>The effects of <code>float_here</code>, <code>adjust_box</code>, and <code>adjust_height</code> can only be seen when compiling the table. The wide column spacing specified by <code>adjust_col_spacing</code> can be observed when comparing with the previous table.</p>
</div>
<div id="updating-variable-names-and-adding-a-caption-and-label" class="section level2 hasAnchor" number="3.4">
<h2 class="hasAnchor"><span class="header-section-number">3.4</span> Updating variable names and adding a caption and label<a href="#updating-variable-names-and-adding-a-caption-and-label" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="updating-independent-variable-names" class="section level3 hasAnchor" number="3.4.1">
<h3 class="hasAnchor"><span class="header-section-number">3.4.1</span> Updating independent variable names<a href="#updating-independent-variable-names" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To update independent variable names, you should define object called <code>coef_names</code> with the detailed independent variable names, and names equal to the original variable names (example beow). <code>coef_map = coef_names</code> is passed on to <code>modelsummary</code>, substituting the original variable names.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>coef_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Sepal length&quot;</span>, <span class="st">&quot;Sepal width&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&quot;Sepal.Length&quot;</span>, <span class="st">&quot;Sepal.Width&quot;</span>))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>current_table <span class="ot">&lt;-</span> <span class="fu">mshow</span>(model_list, </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">coef_map =</span> coef_names,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">output =</span> <span class="st">&quot;latex&quot;</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>current_table <span class="sc">%&gt;%</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write</span>(<span class="fu">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;tables&quot;</span>, <span class="st">&quot;table_3.tex&quot;</span>))</span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/clandinq/recon/main/results/tables/table_3.jpg" width="300" />
</center>
</div>
<div id="adding-dependent-variable-names-and-model-numbers" class="section level3 hasAnchor" number="3.4.2">
<h3 class="hasAnchor"><span class="header-section-number">3.4.2</span> Adding dependent variable names and model numbers<a href="#adding-dependent-variable-names-and-model-numbers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The next step is to add dependent variable names and model numbers to the table. This can be done with function <code>insert_col_numbers</code>. The auxiliary function <code>get_num_cols</code> is defined later in this section.</p>
<p><code>insert_col_numbers</code> has a binary toggle (TRUE includes column numbers, FALSE omits them) so that the function can be included inside other functions. That way, column numbers can be inserted depending on the number of columns.</p>
<p><strong>Function</strong>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>insert_col_numbers <span class="ot">&lt;-</span> <span class="cf">function</span>(table, col_numbers) {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (col_numbers) {</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    table <span class="sc">%&gt;%</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_insert</span>(<span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">midrule&quot;</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">insert =</span> <span class="fu">str_c</span>(<span class="st">&quot;&amp; &quot;</span>, <span class="fu">paste</span>(<span class="fu">str_c</span>(<span class="st">&quot;(&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">get_num_cols</span>(table), <span class="st">&quot;)&quot;</span>), <span class="at">collapse =</span> <span class="st">&quot; &amp; &quot;</span>), <span class="st">&quot;</span><span class="sc">\\\\</span><span class="st">&quot;</span>),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">before =</span> <span class="cn">TRUE</span>) </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    table</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Usage</strong>:</p>
<p>To update dependent variable names, you should set the names of the list with the models equal to the dependent variable names. Then, you can apply the <code>insert_col_numbers</code> function to include column numbers:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>current_table <span class="ot">&lt;-</span> model_list <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&quot;Petal width&quot;</span>, <span class="st">&quot;Petal width&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mshow</span>(<span class="at">coef_map =</span> coef_names,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">output =</span> <span class="st">&quot;latex&quot;</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>current_table <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">insert_col_numbers</span>(<span class="at">col_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write</span>(<span class="fu">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;tables&quot;</span>, <span class="st">&quot;table_4.tex&quot;</span>))</span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/clandinq/recon/main/results/tables/table_4.jpg" width="297" />
</center>
</div>
<div id="adding-a-multicolumn-title" class="section level3 hasAnchor" number="3.4.3">
<h3 class="hasAnchor"><span class="header-section-number">3.4.3</span> Adding a multicolumn title<a href="#adding-a-multicolumn-title" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An alternative to the previous table is to add a multicolumn title that describes the dependent variable. This can be done with function <code>multicol_title</code>, which takes as an input the multicolumn title and has an option to add a horizontal line below the multicolumn title.</p>
<p>The auxiliary function <code>remove_names</code> removes the stock model names to keep only the multicolumn title. Therefore, the model list should remain unnamed. This function depends on another auxiliary function, <code>get_num_cols</code>, which calculates the numbers of columns in the table.</p>
<p><strong>Functions</strong>:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>multicol_title <span class="ot">&lt;-</span> <span class="cf">function</span>(table, title, <span class="at">cline =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  proc_table <span class="ot">&lt;-</span> table <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_insert</span>(<span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">toprule&quot;</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">insert =</span> <span class="fu">str_c</span>(<span class="st">&quot;&amp; </span><span class="sc">\\</span><span class="st">multicolumn{&quot;</span>, <span class="fu">get_num_cols</span>(table), <span class="st">&quot;}{c}{&quot;</span>, title, <span class="st">&quot;} </span><span class="sc">\\\\\n</span><span class="st">%clh&quot;</span>))</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (cline) {</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    proc_table <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_replace</span>(<span class="at">pattern =</span> <span class="st">&quot;%clh&quot;</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">replacement =</span> <span class="fu">str_c</span>(<span class="fu">fixed</span>(<span class="st">&quot;</span><span class="sc">\\\\</span><span class="st">cline{2-&quot;</span>), <span class="fu">get_num_cols</span>(table) <span class="sc">+</span> <span class="dv">1</span>, <span class="st">&quot;}&quot;</span>))</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(proc_table)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>remove_names <span class="ot">&lt;-</span> <span class="cf">function</span>(table) {</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(table, <span class="st">&quot;Model 1&quot;</span>)) {</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    table <span class="sc">%&gt;%</span> </span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_replace</span>(<span class="at">pattern =</span> <span class="fu">fixed</span>(<span class="fu">str_c</span>(<span class="st">&quot;&amp; &quot;</span>, <span class="fu">str_c</span>(<span class="st">&quot;Model &quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">get_num_cols</span>(table), <span class="at">collapse =</span> <span class="st">&quot; &amp; &quot;</span>), <span class="st">&quot;</span><span class="sc">\\\\\n</span><span class="st">&quot;</span>)),</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    table</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>get_num_cols <span class="ot">&lt;-</span> <span class="cf">function</span>(table) {</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  pos_start <span class="ot">&lt;-</span> <span class="fu">str_locate</span>(table, <span class="fu">fixed</span>(<span class="st">&quot;tabular}[t]{&quot;</span>))[<span class="dv">2</span>] <span class="sc">+</span> <span class="dv">1</span> <span class="co"># Get starting position of column alignment</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>  pos_end <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(table, pos_start, pos_start <span class="sc">+</span> <span class="dv">15</span>) <span class="sc">%&gt;%</span>     <span class="co"># Extract end position</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_locate</span>(<span class="fu">fixed</span>(<span class="st">&quot;}&quot;</span>))</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>  pos_end <span class="ot">&lt;-</span> pos_end[<span class="dv">1</span>] <span class="sc">+</span> pos_start <span class="sc">-</span> <span class="dv">2</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  col_num <span class="ot">&lt;-</span> (<span class="fu">str_sub</span>(table, pos_start, pos_end) <span class="sc">%&gt;%</span> <span class="fu">str_length</span>()) <span class="sc">-</span> <span class="dv">1</span> <span class="co"># Exclude leftmost column</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(col_num)</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Usage</strong>:</p>
<p>Remember not to name the model list when using a multicolumn title:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>current_table <span class="ot">&lt;-</span> model_list <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mshow</span>(<span class="at">coef_map =</span> coef_names,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">output =</span> <span class="st">&quot;latex&quot;</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>current_table <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">multicol_title</span>(<span class="st">&quot;Petal Width&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">insert_col_numbers</span>(<span class="at">col_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write</span>(<span class="fu">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;tables&quot;</span>, <span class="st">&quot;table_5.tex&quot;</span>))</span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/clandinq/recon/main/results/tables/table_5.jpg" width="267" />
</center>
</div>
<div id="adding-a-caption-and-title-to-the-table" class="section level3 hasAnchor" number="3.4.4">
<h3 class="hasAnchor"><span class="header-section-number">3.4.4</span> Adding a caption and title to the table<a href="#adding-a-caption-and-title-to-the-table" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>add_caption_label_center</code> is used to add a caption to the table float and define the float label. The caption should be as concise as possible, and the float should have the file name as label to facilitate locating the table in the paper and results folders. This function also centers the table in the middle of the float. <code>float_here</code> is required before <code>add_caption_label_center</code>.</p>
<p><strong>Functions</strong>:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>add_caption_label_center <span class="ot">&lt;-</span> <span class="cf">function</span>(table, caption, label) {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  center <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(table, <span class="st">&quot;centering&quot;</span>), <span class="st">&quot;&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">centering&quot;</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  table <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_insert</span>(<span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">begin{table}[H]&quot;</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">insert =</span> <span class="fu">str_c</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">caption{&quot;</span>, caption, <span class="st">&quot;} </span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;</span><span class="sc">\\</span><span class="st">label{tab:&quot;</span>, label, <span class="st">&quot;}&quot;</span>, center))</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Usage</strong>:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>current_table <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">float_here</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">multicol_title</span>(<span class="st">&quot;Petal Width&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">insert_col_numbers</span>(<span class="at">col_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_caption_label_center</span>(<span class="at">caption =</span> <span class="st">&quot;Correlation Between Flower Petal Width and Sepal Length and Width&quot;</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">label =</span> <span class="st">&quot;flower_table&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write</span>(<span class="fu">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;tables&quot;</span>, <span class="st">&quot;table_6.tex&quot;</span>))</span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/clandinq/recon/main/results/tables/table_6.jpg" width="525" />
</center>
</div>
</div>
<div id="final-table-formatting" class="section level2 hasAnchor" number="3.5">
<h2 class="hasAnchor"><span class="header-section-number">3.5</span> Final table formatting<a href="#final-table-formatting" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="updating-the-number-of-observations" class="section level3 hasAnchor" number="3.5.1">
<h3 class="hasAnchor"><span class="header-section-number">3.5.1</span> Updating the number of observations<a href="#updating-the-number-of-observations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Two functions can help to update the number of observations:</p>
<ul>
<li><p><code>comma_numobs</code> inserts a comma every three digits in the number of observations. The auxiliary function <code>comma_format</code> is used by this function.</p></li>
<li><p><code>replace_numobs</code> replaces “Num.Obs” with a custom text (e.g. “Number of observations” or “Number of firms”).</p></li>
</ul>
<p><strong>Functions</strong>:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>comma_format <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">override_right_digits =</span> <span class="cn">NA</span>) {</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate number of right digits</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x <span class="sc">&lt;=</span> <span class="dv">0</span>) {num <span class="ot">&lt;-</span> <span class="dv">1</span>} <span class="cf">else</span> {num <span class="ot">&lt;-</span> x}</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  right_digits <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">-</span> <span class="fu">floor</span>(<span class="fu">log10</span>(<span class="fu">abs</span>(num)))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (right_digits <span class="sc">&lt;</span> <span class="dv">0</span>) {right_digits <span class="ot">&lt;-</span> <span class="dv">0</span>}</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (right_digits <span class="sc">&gt;</span> <span class="dv">3</span>) {right_digits <span class="ot">&lt;-</span> <span class="dv">3</span>}</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(override_right_digits)) {right_digits <span class="ot">&lt;-</span> override_right_digits}</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate number of left digits</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  left_digits <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="sc">+</span> <span class="fu">floor</span>(<span class="fu">log10</span>(<span class="fu">abs</span>(num)))</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (left_digits <span class="sc">&lt;=</span> <span class="dv">0</span>) {left_digits <span class="ot">&lt;-</span> <span class="dv">1</span>}</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Format number</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  proc_num <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">round</span>(x, right_digits), <span class="at">nsmall =</span> right_digits, <span class="at">digits =</span>  left_digits, <span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (proc_num <span class="sc">!=</span> <span class="st">&quot;0&quot;</span> <span class="sc">&amp;</span> <span class="fu">as.numeric</span>(<span class="fu">str_replace</span>(proc_num, <span class="fu">fixed</span>(<span class="st">&quot;,&quot;</span>), <span class="st">&quot;&quot;</span>)) <span class="sc">&lt;</span> <span class="dv">1</span>) {</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    proc_num <span class="ot">&lt;-</span> <span class="fu">str_pad</span>(proc_num, right_digits <span class="sc">+</span> <span class="dv">2</span>, <span class="st">&quot;right&quot;</span>, <span class="st">&quot;0&quot;</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(proc_num)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>comma_numobs <span class="ot">&lt;-</span> <span class="cf">function</span>(models) {</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  model_proc <span class="ot">&lt;-</span> models</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(model_proc)) {</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    model_proc[[i]]<span class="sc">$</span>nobs <span class="ot">&lt;-</span> <span class="fu">comma</span>(model_proc[[i]]<span class="sc">$</span>nobs)</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(model_proc)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>replace_numobs <span class="ot">&lt;-</span> <span class="cf">function</span>(table, text) {</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>  table <span class="sc">%&gt;%</span> </span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace</span>(<span class="at">pattern =</span> <span class="st">&quot;Num.Obs.&quot;</span>,</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>                <span class="at">replacement =</span> text) <span class="sc">%&gt;%</span> </span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace</span>(<span class="at">pattern =</span> <span class="st">&quot;Num. Obs.&quot;</span>,</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>                <span class="at">replacement =</span> text)</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Usage</strong>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>current_table <span class="ot">&lt;-</span> model_list <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">comma_numobs</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mshow</span>(<span class="at">coef_map =</span> coef_names,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">output =</span> <span class="st">&quot;latex&quot;</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>current_table <span class="sc">%&gt;%</span> </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">float_here</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">multicol_title</span>(<span class="st">&quot;Petal Width&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">insert_col_numbers</span>(<span class="at">col_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_caption_label_center</span>(<span class="at">caption =</span> <span class="st">&quot;Correlation Between Flower Petal Width and Sepal Length and Width&quot;</span>,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">label =</span> <span class="st">&quot;flower_table&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_numobs</span>(<span class="st">&quot;Number of observations&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write</span>(<span class="fu">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;tables&quot;</span>, <span class="st">&quot;table_7.tex&quot;</span>))</span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/clandinq/recon/main/results/tables/table_7.jpg" width="525" />
</center>
</div>
<div id="inserting-additional-data-rows" class="section level3 hasAnchor" number="3.5.2">
<h3 class="hasAnchor"><span class="header-section-number">3.5.2</span> Inserting additional data rows<a href="#inserting-additional-data-rows" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Often it’s useful to insert additional rows with statistics, for example means and medians. You can feed <code>modelsummary</code> a dataframe with the desired content and add these rows below the number of observations.</p>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define additional rows</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>petal_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(iris<span class="sc">$</span>Petal.Width) <span class="sc">%&gt;%</span> <span class="fu">comma_format</span>()</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>sepal_length_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(iris<span class="sc">$</span>Sepal.Length)  <span class="sc">%&gt;%</span> <span class="fu">comma_format</span>()</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>sepal_width_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(iris<span class="sc">$</span>Sepal.Width) <span class="sc">%&gt;%</span> <span class="fu">comma_format</span>()</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>add_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="st">&quot;Mean petal width&quot;</span>, <span class="fu">rep</span>(petal_mean, <span class="dv">2</span>)),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">c</span>(<span class="st">&quot;Mean sepal length&quot;</span>, <span class="fu">rep</span>(sepal_length_mean, <span class="dv">2</span>)),</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">c</span>(<span class="st">&quot;Mean sepal width&quot;</span>, <span class="fu">rep</span>(sepal_width_mean, <span class="dv">2</span>))))</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Add rows to previous table</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>current_table <span class="ot">&lt;-</span> model_list <span class="sc">%&gt;%</span> </span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">comma_numobs</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mshow</span>(<span class="at">coef_map =</span> coef_names,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">add_rows =</span> add_row,</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">output =</span> <span class="st">&quot;latex&quot;</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>current_table <span class="sc">%&gt;%</span> </span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">float_here</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">multicol_title</span>(<span class="st">&quot;Petal Width&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">insert_col_numbers</span>(<span class="at">col_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_caption_label_center</span>(<span class="at">caption =</span> <span class="st">&quot;Correlation Between Flower Petal Width and Sepal Length and Width&quot;</span>,</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>                           <span class="at">label =</span> <span class="st">&quot;flower_table&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_numobs</span>(<span class="st">&quot;Number of observations&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write</span>(<span class="fu">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;tables&quot;</span>, <span class="st">&quot;table_8.tex&quot;</span>))</span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/clandinq/recon/main/results/tables/table_8.jpg" width="525" />
</center>
</div>
<div id="distributing-coefficient-names-over-two-rows" class="section level3 hasAnchor" number="3.5.3">
<h3 class="hasAnchor"><span class="header-section-number">3.5.3</span> Distributing coefficient names over two rows<a href="#distributing-coefficient-names-over-two-rows" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Interactions of variables frequently generate excessively long variable names. One solution for this is to split the variable name in two and put the second part of the variable name in the next row. Function <code>coef_two_rows</code> can do this automatically; all this needs is for the interaction variable to include “times” between the two variables.</p>
<p><strong>Functions</strong>:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>coef_two_rows <span class="ot">&lt;-</span> <span class="cf">function</span>(table) {</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check number of string locations</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  string_loc <span class="ot">&lt;-</span> <span class="fu">str_locate_all</span>(table, <span class="st">&quot;times&quot;</span>)[[<span class="dv">1</span>]]</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  num_locations <span class="ot">&lt;-</span> <span class="fu">nrow</span>(string_loc)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate temporary output</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> table</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tag words</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  tagged_string <span class="ot">&lt;-</span> <span class="st">&quot;REPtimes&quot;</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  output <span class="sc">%&lt;&gt;%</span> <span class="fu">str_replace_all</span>(<span class="st">&quot;times&quot;</span>, tagged_string)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop over string locations</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(string_loc)) {</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Locate coefficient string to replace with &quot;&quot;</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    pat_loc <span class="ot">&lt;-</span> <span class="fu">str_locate</span>(output, <span class="fu">fixed</span>(tagged_string))[<span class="dv">1</span>]</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Locate lower row to replace with coefficient string</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    upper_row <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(output, pat_loc, <span class="fu">str_length</span>(output))</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    lower_row <span class="ot">&lt;-</span> upper_row <span class="sc">%&gt;%</span> </span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_sub</span>(<span class="fu">str_locate</span>(upper_row, <span class="fu">fixed</span>(<span class="st">&quot;</span><span class="sc">\\\\\n</span><span class="st"> &quot;</span>))[<span class="dv">2</span>] <span class="sc">+</span> <span class="dv">1</span>, <span class="fu">str_length</span>(upper_row))</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define pattern to replace in upper row</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    pat_rep_upper <span class="ot">&lt;-</span> <span class="fu">str_split</span>(upper_row, <span class="st">&quot;&amp;&quot;</span>, <span class="at">n =</span> <span class="dv">2</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>]</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define pattern to replace in lower row</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    pat_rep_lower <span class="ot">&lt;-</span> lower_row <span class="sc">%&gt;%</span> </span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_sub</span>(<span class="dv">1</span>, <span class="fu">str_locate</span>(lower_row, <span class="fu">fixed</span>(<span class="st">&quot;</span><span class="sc">\\\\\n</span><span class="st">&quot;</span>))[<span class="dv">2</span>])</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replace strings in table.</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    output <span class="sc">%&lt;&gt;%</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_replace</span>(<span class="at">pattern =</span> pat_rep_upper,</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_replace</span>(<span class="at">pattern =</span> <span class="fu">fixed</span>(pat_rep_lower),</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">replacement =</span> <span class="fu">str_c</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">quad $</span><span class="sc">\\</span><span class="st">times$&quot;</span>, </span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">str_replace</span>(pat_rep_upper, tagged_string, <span class="st">&quot;&quot;</span>),</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>                                      pat_rep_lower))</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>  }  </span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Usage</strong>:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add new variable to dataset.</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>current_data <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">random =</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="fu">nrow</span>(.), <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define model</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">feols</span>(Petal.Width <span class="sc">~</span> Sepal.Length <span class="sc">*</span> random,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">fixef =</span> <span class="st">&quot;Species&quot;</span>,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">cluster =</span> <span class="st">&quot;Species&quot;</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> current_data)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define coefficient names</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>coef_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Sepal length&quot;</span>, <span class="st">&quot;Random variable&quot;</span>, <span class="st">&quot;Sepal length times Random variable&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&quot;Sepal.Length&quot;</span>, <span class="st">&quot;random&quot;</span>, <span class="st">&quot;Sepal.Length:random&quot;</span>))</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Export table</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>current_table <span class="ot">&lt;-</span> model_list <span class="sc">%&gt;%</span> </span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">append</span>(<span class="fu">list</span>(m3)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">comma_numobs</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mshow</span>(<span class="at">coef_map =</span> coef_names,</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">output =</span> <span class="st">&quot;latex&quot;</span>)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>current_table <span class="sc">%&gt;%</span> </span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">float_here</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">multicol_title</span>(<span class="st">&quot;Petal Width&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">insert_col_numbers</span>(<span class="at">col_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_caption_label_center</span>(<span class="at">caption =</span> <span class="st">&quot;Correlation Between Flower Petal Width and Sepal Length and Width&quot;</span>,</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>                           <span class="at">label =</span> <span class="st">&quot;flower_table&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_numobs</span>(<span class="st">&quot;Number of observations&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef_two_rows</span>() <span class="sc">%&gt;%</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write</span>(<span class="fu">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;tables&quot;</span>, <span class="st">&quot;table_9.tex&quot;</span>))</span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/clandinq/recon/main/results/tables/table_9.jpg" width="525" />
</center>
</div>
<div id="inserting-space-between-variables" class="section level3 hasAnchor" number="3.5.4">
<h3 class="hasAnchor"><span class="header-section-number">3.5.4</span> Inserting space between variables<a href="#inserting-space-between-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In tables with two-line variable names, it can be easier to read the table when there is sufficient spacing between each set of variable coefficient and standard errors. The function <code>add_line_space</code> inserts vertical space between each set of variable numbers and facilitates reading the table.</p>
<p><strong>Function</strong>:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>add_line_space <span class="ot">&lt;-</span> <span class="cf">function</span>(table) {</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep split rows after first parentheses.</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  keep_after_firstpar <span class="ot">&lt;-</span> (table <span class="sc">%&gt;%</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">str_sub</span>(<span class="fu">str_locate</span>(table, <span class="fu">fixed</span>(<span class="st">&quot;(&quot;</span>))[<span class="dv">1</span>], <span class="fu">str_length</span>(table)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">str_split</span>(<span class="st">&quot;</span><span class="sc">\\\n</span><span class="st">&quot;</span>))[[<span class="dv">1</span>]]</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep rows with parentheses.</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  keep_after_firstpar <span class="ot">&lt;-</span> keep_after_firstpar[<span class="fu">str_detect</span>(keep_after_firstpar, <span class="fu">fixed</span>(<span class="st">&quot;(&quot;</span>))]</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Drop first one (column numbers)</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  keep_after_firstpar <span class="ot">&lt;-</span> keep_after_firstpar[<span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(keep_after_firstpar)]</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Replace with spacing.</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  proc_table <span class="ot">&lt;-</span> table</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(keep_after_firstpar)) {</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    proc_table <span class="sc">%&lt;&gt;%</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_replace</span>(<span class="at">pattern =</span> <span class="fu">fixed</span>(keep_after_firstpar[i]),</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">replacement =</span> <span class="fu">str_c</span>(keep_after_firstpar[i], <span class="st">&quot;[0.3cm]&quot;</span>))</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(proc_table)</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Usage</strong>:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>current_table <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">float_here</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">multicol_title</span>(<span class="st">&quot;Petal Width&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">insert_col_numbers</span>(<span class="at">col_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_caption_label_center</span>(<span class="at">caption =</span> <span class="st">&quot;Correlation Between Flower Petal Width and Sepal Length and Width&quot;</span>,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">label =</span> <span class="st">&quot;flower_table&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_numobs</span>(<span class="st">&quot;Number of observations&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef_two_rows</span>() <span class="sc">%&gt;%</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_line_space</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write</span>(<span class="fu">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;tables&quot;</span>, <span class="st">&quot;table_10.tex&quot;</span>))</span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/clandinq/recon/main/results/tables/table_10.jpg" width="451" />
</center>
</div>
</div>
<div id="putting-it-all-together" class="section level2 hasAnchor" number="3.6">
<h2 class="hasAnchor"><span class="header-section-number">3.6</span> Putting it all together<a href="#putting-it-all-together" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="combining-everything-into-one-simple-function" class="section level3 hasAnchor" number="3.6.1">
<h3 class="hasAnchor"><span class="header-section-number">3.6.1</span> Combining everything into one simple function<a href="#combining-everything-into-one-simple-function" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Most of the previous tables can be combined into one simple function: <code>gen_base_table</code>. The only non-auxiliary functions that are not included by default in the options are <code>adjust_height</code>, <code>adjust_col_spacing</code>, <code>coef_two_rows</code> and <code>add_line_space</code>.</p>
<p><strong>Function</strong>:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>gen_base_table <span class="ot">&lt;-</span> <span class="cf">function</span>(models, caption, label, <span class="at">title =</span> <span class="cn">NULL</span>, <span class="at">cline =</span> <span class="cn">FALSE</span>, coef_names, <span class="at">numobs =</span> <span class="st">&quot;Number of observations&quot;</span>, ...) {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get length of model. If large, it is a regression that needs to be put in a list</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(models) <span class="sc">&gt;</span> <span class="dv">10</span>) {models <span class="ot">&lt;-</span> <span class="fu">list</span>(models)}</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate table</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> models <span class="sc">%&gt;%</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fix number of observation number format</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">comma_numobs</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate table with modelsummary</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">modelsummary</span>(<span class="at">coef_map =</span> coef_names,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stars =</span> <span class="fu">c</span>(<span class="st">&quot;*&quot;</span> <span class="ot">=</span> .<span class="dv">1</span>, <span class="st">&quot;**&quot;</span> <span class="ot">=</span> .<span class="dv">05</span>, <span class="st">&quot;***&quot;</span> <span class="ot">=</span> <span class="fl">0.01</span>),</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">gof_omit =</span> <span class="st">&quot;AIC|BIC|R2|R2 Adj.|R2 Pseudo|R2 Within|Log.Lik.|Std.Errors|FE|RMSE&quot;</span>,</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">escape =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">output =</span> <span class="st">&quot;latex&quot;</span>,</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>                 ...) <span class="sc">%&gt;%</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Insert float here option</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">float_here</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Insert adjustbox</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">adjust_box</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add caption and label</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_caption_label_center</span>(<span class="at">caption =</span> caption,</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>                             <span class="at">label =</span> label) <span class="sc">%&gt;%</span> </span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Insert column numbers</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">insert_col_numbers</span>(<span class="fu">ifelse</span>(<span class="fu">length</span>(models) <span class="sc">==</span> <span class="dv">1</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove model names if no unique column names given</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">remove_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replace number of observations (Num.Obs. with Num. Obs.)</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">replace_numobs</span>(numobs)</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(title)) {</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>    output <span class="sc">%&lt;&gt;%</span> <span class="fu">multicol_title</span>(title, <span class="at">cline =</span> cline)</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Usage</strong>:</p>
<p>You can replicate the previous table with this simple command:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>model_list <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">append</span>(<span class="fu">list</span>(m3)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gen_base_table</span>(<span class="at">caption =</span> <span class="st">&quot;Correlation Between Flower Petal Width and Sepal Length and Width&quot;</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label =</span> <span class="st">&quot;flower_table&quot;</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">title =</span> <span class="st">&quot;Petal Width&quot;</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">coef_names =</span> coef_names) <span class="sc">%&gt;%</span> </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef_two_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_line_space</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write</span>(<span class="fu">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;tables&quot;</span>, <span class="st">&quot;table_11.tex&quot;</span>))</span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/clandinq/recon/main/results/tables/table_10.jpg" width="451" />
</center>
</div>
<div id="adding-footnotes" class="section level3 hasAnchor" number="3.6.2">
<h3 class="hasAnchor"><span class="header-section-number">3.6.2</span> Adding footnotes<a href="#adding-footnotes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The final step is to remove the notes from the bottom of the table and include our own footnote. You can do this with function <code>format_save_footnote</code> and including <code>options("modelsummary_stars_note" = FALSE)</code> in your code. This function saves a footnote to a file with the same name as the table in the folder /results/notes. This makes it easier to locate notes and include them in the LaTeX document the following way:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>\input{..<span class="sc">/</span>results<span class="sc">/</span>tables<span class="sc">/</span>current_table.tex}</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>\input{..<span class="sc">/</span>results<span class="sc">/</span>notes<span class="sc">/</span>current_table.tex}</span></code></pre></div>
<p><strong>Usage</strong></p>
<p><strong>Function</strong>:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>format_save_footnote <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">text =</span> <span class="st">&quot;&quot;</span>, filename, <span class="at">stars =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  sig <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(stars, <span class="st">&quot; * $p &lt; 0.1$, ** $p &lt; 0.05$, *** $p &lt; 0.01$.&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  footnote <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">footnotesize </span><span class="sc">\n</span><span class="st">&quot;</span>, </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;</span><span class="sc">\\</span><span class="st">begin{justify} </span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;</span><span class="sc">\\</span><span class="st">emph{Note}: &quot;</span>, text, sig, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;</span><span class="sc">\\</span><span class="st">end{justify} </span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;</span><span class="sc">\\</span><span class="st">normalsize </span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  clean_filename <span class="ot">&lt;-</span> <span class="fu">str_split</span>(filename, <span class="fu">fixed</span>(<span class="st">&quot;.&quot;</span>))[[<span class="dv">1</span>]][<span class="dv">1</span>]</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write</span>(footnote, <span class="fu">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;notes&quot;</span>, <span class="fu">str_c</span>(clean_filename, <span class="st">&quot;.tex&quot;</span>)))</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Usage</strong>:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">&quot;modelsummary_stars_note&quot;</span> <span class="ot">=</span> <span class="cn">FALSE</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (generate previous table after running this line)</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;This table reports the correlation between petal width and sepal lenght and width.&quot;</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;The unit of observation is at the plant level.&quot;</span>,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;The coefficients come from the regression of petal width on sepal length (column (1)), the regression of petal width on sepal length and sepal width (column (2)), and the regression of petal width on a random dummy variable, sepal length and the interaction between these two variables (column (3)).&quot;</span>,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Data comes from the iris dataset.&quot;</span>,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;All estimations include species fixed effects, and standard errors clustered at the species level are included in parentheses.&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format_save_footnote</span>(<span class="st">&quot;current_table.tex&quot;</span>, <span class="at">stars =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/clandinq/recon/main/results/tables/table_12.jpg" width="451" />
</center>
</div>
</div>
<div id="preparing-tables-for-presentations" class="section level2 hasAnchor" number="3.7">
<h2 class="hasAnchor"><span class="header-section-number">3.7</span> Preparing tables for presentations<a href="#preparing-tables-for-presentations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Once you have generated a final version of the table, there are a few functions that can easily generate a presentation version of the table, remove unwanted rows and add short notes at the bottom of the table.</p>
<div id="generating-presentation-versions-of-tables" class="section level3 hasAnchor" number="3.7.1">
<h3 class="hasAnchor"><span class="header-section-number">3.7.1</span> Generating presentation versions of tables<a href="#generating-presentation-versions-of-tables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Presentation versions of tables only include the content between <code>\begin{tabulate}</code> and <code>\end{tabulate}</code>. <code>convert_save_pres_table</code> can do this conversion rapidly. By default, this table looks for the input table in /results/tables, and saves the output to the same folder with the <em>pres_</em> prefix.</p>
<p><strong>Function</strong>:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>convert_save_pres_table <span class="ot">&lt;-</span> <span class="cf">function</span>(table_name, <span class="at">table_path =</span> <span class="fu">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;tables&quot;</span>), <span class="at">output_path =</span> <span class="fu">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;tables&quot;</span>)) {</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  table <span class="ot">&lt;-</span> <span class="fu">read_file</span>(<span class="fu">here</span>(table_path, table_name))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  table <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(table,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">str_locate</span>(table, <span class="fu">fixed</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">begin{tabular}&quot;</span>))[<span class="dv">1</span>],</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">str_locate</span>(table, <span class="fu">fixed</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">end{tabular}&quot;</span>))[<span class="dv">2</span>])</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  pres_table_name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;pres_&quot;</span>, table_name)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write</span>(table, <span class="fu">here</span>(output_path, pres_table_name))</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">str_c</span>(<span class="st">&quot;Presentation table saved to&quot;</span>,</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">str_remove</span>(output_path, <span class="fu">here</span>()), <span class="st">&quot;/&quot;</span>, pres_table_name))</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Usage</strong>:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">convert_save_pres_table</span>(<span class="st">&quot;table_11.tex&quot;</span>)</span></code></pre></div>
</div>
<div id="removing-standard-errors-and-column-numbers" class="section level3 hasAnchor" number="3.7.2">
<h3 class="hasAnchor"><span class="header-section-number">3.7.2</span> Removing standard errors and column numbers<a href="#removing-standard-errors-and-column-numbers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Removing standard errors and column numbers can make it easier to fit tables in presentations without having to reduce the font size too much. <code>remove_std_errors_col_nums</code> is another simple function with no options that can quickly perform this modification.</p>
<p><strong>Function</strong>:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>remove_std_errors_col_nums <span class="ot">&lt;-</span> <span class="cf">function</span>(table) {</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  table <span class="sc">%&gt;%</span>   </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_split</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    .[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    .[<span class="sc">!</span>(<span class="fu">str_detect</span>(., <span class="fu">fixed</span>(<span class="st">&quot;(&quot;</span>)))] <span class="sc">%&gt;%</span> </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_c</span>(<span class="at">collapse =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Usage</strong>:</p>
<p>This would require saving a version of the original table without standard errors and column numbers, and then converting to a presentation version. The previous table would look like this:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_file</span>(<span class="fu">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;tables&quot;</span>, <span class="st">&quot;table_12.tex&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_std_errors_col_nums</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write</span>(<span class="fu">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;tables&quot;</span>, <span class="st">&quot;table_13.tex&quot;</span>))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">convert_save_pres_table</span>(<span class="st">&quot;table_13.tex&quot;</span>)</span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/clandinq/recon/main/results/tables/pres_table_13.jpg" width="462" />
</center>
</div>
<div id="adding-notes" class="section level3 hasAnchor" number="3.7.3">
<h3 class="hasAnchor"><span class="header-section-number">3.7.3</span> Adding notes<a href="#adding-notes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Finally, although it’s best practice not to add notes directly to a table, it is the only way you can add a note to a presentation table (since footnotes can’t be included). <code>add_note</code> can be used for adding notes to presentation tables.</p>
<p><strong>Function</strong>:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>add_note <span class="ot">&lt;-</span> <span class="cf">function</span>(table, note) {</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  table <span class="sc">%&gt;%</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_insert</span>(<span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">bottomrule&quot;</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">insert =</span> <span class="fu">str_c</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">multicolumn{&quot;</span>, <span class="fu">get_num_cols</span>(table) <span class="sc">+</span> <span class="dv">1</span>, <span class="st">&quot;}{c}{&quot;</span>, note, <span class="st">&quot;}&quot;</span>))</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Usage</strong>:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_file</span>(<span class="fu">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;tables&quot;</span>, <span class="st">&quot;pres_table_13.tex&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_note</span>(<span class="st">&quot;Quick note at the bottom of the presentation table.&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write</span>(<span class="fu">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;tables&quot;</span>, <span class="st">&quot;table_14.tex&quot;</span>))</span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/clandinq/recon/main/results/tables/table_14.jpg" width="462" />
</center>
<!--chapter:end:02-tables.Rmd-->
</div>
</div>
</div>
<div id="statistical-tests" class="section level1 hasAnchor" number="4">
<h1 class="hasAnchor"><span class="header-section-number">4</span> Statistical tests<a href="#statistical-tests" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this section, we introduce functions for performing hypothesis tests on model coefficients using the <code>multcomp</code> package.
We introduce a function called <code>extract_test_coef</code> that tests a hypothesis on model parameters and extracts the resulting p-values of the test.
Then, we show the usage of the function with an example using the <code>iris</code> dataset.</p>
<div id="easy-two-sided-hypothesis-tests-in-r" class="section level2 hasAnchor" number="4.1">
<h2 class="hasAnchor"><span class="header-section-number">4.1</span> Easy two-sided hypothesis tests in R<a href="#easy-two-sided-hypothesis-tests-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>First, load the required packages and the <code>iris</code> dataset.
The packages needed are <code>tidyverse</code> for data manipulation, <code>fixest</code> for estimating models, <code>modelsummary</code> for displaying model results, <code>multcomp</code> for estimating hypothesis tests and <code>conflicted</code> to deal with conflicts in function names.
With package <code>conflicted</code>, we can specify which package to use for a given function.
Since <code>multcomp</code> and <code>dplyr</code> conflict in multiple functions, we can specify which package to use for each function and give preference to <code>dplyr</code>.
The <code>iris</code> dataset contains measurements of 4 attributes for 50 flowers from 3 different species.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, fixest, modelsummary, multcomp, </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>               conflicted, fastDummies)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolve conflicts</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">&quot;select&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">&quot;last&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Load iris data</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(iris)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris)</span></code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa
## 4          4.6         3.1          1.5         0.2  setosa
## 5          5.0         3.6          1.4         0.2  setosa
## 6          5.4         3.9          1.7         0.4  setosa</code></pre>
<p>Next, we define terciles of sepal width and a simple model using package <code>fixest</code>.
We show the model results using the <code>mshow</code> function defined in the previous chapter.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define terciles of sepal width</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>proc_data <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sepal_width_tercile =</span> <span class="fu">ntile</span>(Sepal.Width, <span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dummy_cols</span>(<span class="st">&quot;sepal_width_tercile&quot;</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define coefficient names</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>coef_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Sepal length&quot;</span>, <span class="st">&quot;First tercile sepal width&quot;</span>, <span class="st">&quot;Second tercile sepal width&quot;</span>, <span class="st">&quot;Third tercile sepal width&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&quot;Sepal.Length&quot;</span>, <span class="fu">str_c</span>(<span class="st">&quot;sepal_width_tercile_&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)))</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Define model </span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">feols</span>(Petal.Width <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Sepal.Length <span class="sc">+</span> sepal_width_tercile_1 <span class="sc">+</span> sepal_width_tercile_2 <span class="sc">+</span> sepal_width_tercile_3,</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">se =</span> <span class="st">&quot;hetero&quot;</span>,</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> proc_data)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="fu">mshow</span>(<span class="fu">list</span>(<span class="st">&quot;Petal width&quot;</span> <span class="ot">=</span> m1), <span class="at">coef_map =</span> coef_names)</span></code></pre></div>
<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Petal width
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Sepal length
</td>
<td style="text-align:center;">
0.732***
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.041)
</td>
</tr>
<tr>
<td style="text-align:left;">
First tercile sepal width
</td>
<td style="text-align:center;">
−2.882***
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.242)
</td>
</tr>
<tr>
<td style="text-align:left;">
Second tercile sepal width
</td>
<td style="text-align:center;">
−3.083***
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.237)
</td>
</tr>
<tr>
<td style="text-align:left;">
Third tercile sepal width
</td>
<td style="text-align:center;">
−3.261***
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
(0.215)
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
150
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup></sup> * p &lt; 0.1, ** p &lt; 0.05, *** p &lt; 0.01
</td>
</tr>
</tfoot>
</table>
<p>The next step is to use the function <code>extract_test_coef</code> to test two hypothesis:</p>
<ol style="list-style-type: decimal">
<li>The effect of the first tercile of sepal width on petal width is equal to the effect of the second tercile of sepal width on petal width</li>
<li>The effect of the first tercile of sepal width on petal width is equal to the effect of the third tercile of sepal width on petal width The function returns p-values for each test.</li>
</ol>
<p>The expression included in the function must be in the form <strong><code>coef_a == coef_b</code></strong> and will perform a two-sided hypothesis test where the null hypothesis is <span class="math inline">\(H_0: coef_a = coef_b\)</span>.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define function</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>extract_test_coef <span class="ot">&lt;-</span> <span class="cf">function</span>(model, comp) {</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  expr <span class="ot">&lt;-</span> comp <span class="sc">%&gt;%</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace</span>(<span class="at">pattern =</span> <span class="fu">fixed</span>(<span class="st">&quot;==&quot;</span>),</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">replacement =</span> <span class="st">&quot;-&quot;</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span> </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">glht</span>(<span class="at">linfct =</span> <span class="fu">str_c</span>(expr, <span class="st">&quot;= 0&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">confint</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>()</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">as.numeric</span>(res<span class="sc">$</span>test<span class="sc">$</span>pvalues))</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Test hypotheses</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>pval_1_2 <span class="ot">&lt;-</span> <span class="fu">extract_test_coef</span>(m1, <span class="st">&quot;sepal_width_tercile_1 == sepal_width_tercile_2&quot;</span>)</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>pval_1_3 <span class="ot">&lt;-</span> <span class="fu">extract_test_coef</span>(m1, <span class="st">&quot;sepal_width_tercile_1 == sepal_width_tercile_3&quot;</span>)</span></code></pre></div>
<p>Finally, we add the p-values to the model results using the <code>add_row</code> argument of the <code>mshow</code> function.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add p-values to model results</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>add_row <span class="ot">&lt;-</span> <span class="fu">tribble</span>(<span class="sc">~</span>name, <span class="sc">~</span>value,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;P-value (Sepal width 1st tercile = Sepal width 2nd tercile)&quot;</span>, <span class="fu">comma_format</span>(pval_1_2),</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;P-value (Sepal width 1st tercile = Sepal width 3rd tercile)&quot;</span>, <span class="fu">comma_format</span>(pval_1_3))</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mshow</span>(<span class="fu">list</span>(<span class="st">&quot;Petal width&quot;</span> <span class="ot">=</span> m1), </span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">coef_map =</span> coef_names, </span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">add_row =</span> add_row)</span></code></pre></div>
<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Petal width
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Sepal length
</td>
<td style="text-align:center;">
0.732***
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.041)
</td>
</tr>
<tr>
<td style="text-align:left;">
First tercile sepal width
</td>
<td style="text-align:center;">
−2.882***
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.242)
</td>
</tr>
<tr>
<td style="text-align:left;">
Second tercile sepal width
</td>
<td style="text-align:center;">
−3.083***
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.237)
</td>
</tr>
<tr>
<td style="text-align:left;">
Third tercile sepal width
</td>
<td style="text-align:center;">
−3.261***
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
(0.215)
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
150
</td>
</tr>
<tr>
<td style="text-align:left;">
P-value (Sepal width 1st tercile = Sepal width 2nd tercile)
</td>
<td style="text-align:center;">
0.008
</td>
</tr>
<tr>
<td style="text-align:left;">
P-value (Sepal width 1st tercile = Sepal width 3rd tercile)
</td>
<td style="text-align:center;">
0.000
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup></sup> * p &lt; 0.1, ** p &lt; 0.05, *** p &lt; 0.01
</td>
</tr>
</tfoot>
</table>
<p>From the results of these hypotheses tests, we can reject the hypothesis that the effect of the first tercile of sepal width on petal width is equal to the effect of the second tercile of sepal width on petal width, and that the effect of the first tercile of sepal width on petal width is equal to the effect of the third tercile of sepal width on petal width.</p>
<!--chapter:end:03-stat_tests.Rmd-->
</div>
</div>
<div id="geographic-place-matching" class="section level1 hasAnchor" number="5">
<h1 class="hasAnchor"><span class="header-section-number">5</span> Geographic place matching<a href="#geographic-place-matching" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In applied work, we often have to deal with observations that have an associated address or coordinates but no geographic codes. For cases in which no coordinates are available, one option is to match addresses to coordinates using Google Place API searches, and then merge the resulting coordinates with shapefiles to obtain geographic codes.</p>
<div id="google-places-api-searches" class="section level2 hasAnchor" number="5.1">
<h2 class="hasAnchor"><span class="header-section-number">5.1</span> Google Places API searches<a href="#google-places-api-searches" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>R package <code>googleway</code> makes it easy to perform Google Place API searches. <code>googleway::google_find_place</code> generates a <a href="https://developers.google.com/maps/documentation/places/web-service/search-find-place">Find Place request</a>, taking a text input and returning an array of place candidates, along with their corresponding search status. From this result, we can extract the address and coordinates.</p>
<p>Currently, you get $200 of Google Maps Platform usage every month for free. <a href="https://mapsplatform.google.com/pricing/">Each request costs $0.017</a>. While this may seem like little, generating 12,000 requests will already exceed the monthly free usage quota ($200 = 11,764.7 requests). It’s easy to exceed this number of requests when you’re running loops for large query vectors repeatedly. Therefore, the best practice is to start out with a small sample, ensure that searches are returning valid results, and then extend the method to the full sample. You can <a href="https://developers.google.com/maps/documentation/places/web-service/report-monitor#quotas">set a maximum quota</a> of 375 requests per day (375 x 31 = 11,625) to ensure you don’t exceed the monthly free usage limit.</p>
<p>To start using <code>googleway</code> to conduct Google Place API searches, you first need to <a href="https://developers.google.com/maps/documentation/places/web-service/cloud-setup">create a Google Cloud project</a> and <a href="https://developers.google.com/maps/documentation/places/web-service/get-api-key">set up an API key</a>. Once you have set this up, you can load <code>googleway</code>, define the API key and start conducting searches.
Here is a simple example of an individual query.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(here, tidyverse, googleway)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co"># (1.1): Set Google Place search API key.</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>key <span class="ot">&lt;-</span> <span class="st">&quot;KJzaLyCLI-nXPsHqVwz-jna1HYg2jKpBueSsTWs&quot;</span> <span class="co"># insert API key here</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set_key</span>(key)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># (1.2): Define tibble with addresses to look up.</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>missing_locs <span class="ot">&lt;-</span> <span class="fu">tribble</span>(<span class="sc">~</span>id, <span class="sc">~</span>address,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">1</span>, <span class="st">&quot;Av. Álvaro Obregón 225, Roma Norte, Cuauhtémoc, CDMX, Mexico&quot;</span>,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">2</span>, <span class="st">&quot;Río Hondo #1, Col. Progreso Tizapán, Álvaro Obregón, CDMX, México&quot;</span>)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="co"># (1.3): Loop over missing addresses.</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>loc_coords <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(missing_locs)) {     </span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get results from Google Place search</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">google_find_place</span>(missing_locs<span class="sc">$</span>address[i], <span class="at">inputtype =</span> <span class="st">&quot;textquery&quot;</span>, <span class="at">language =</span> <span class="st">&quot;es&quot;</span>)</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print results</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>  search_status <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(results[[<span class="st">&quot;status&quot;</span>]] <span class="sc">==</span> <span class="st">&quot;OK&quot;</span>, </span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;search successful&quot;</span>, </span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;search returned no results&quot;</span>)</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">str_c</span>(<span class="st">&quot;Working on address &quot;</span>, i, <span class="st">&quot; out of &quot;</span>, <span class="fu">nrow</span>(missing_locs), <span class="st">&quot;, &quot;</span>, search_status))</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract formatted address and coordinates results</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>  clean_results <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id =</span> missing_locs<span class="sc">$</span>id[i],</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>                          <span class="at">address_clean =</span> results[[<span class="st">&quot;candidates&quot;</span>]][[<span class="st">&quot;formatted_address&quot;</span>]],</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>                          <span class="at">loc_lat =</span> results[[<span class="st">&quot;candidates&quot;</span>]][[<span class="st">&quot;geometry&quot;</span>]][[<span class="st">&quot;location&quot;</span>]][[<span class="st">&quot;lat&quot;</span>]],</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>                          <span class="at">loc_lon =</span> results[[<span class="st">&quot;candidates&quot;</span>]][[<span class="st">&quot;geometry&quot;</span>]][[<span class="st">&quot;location&quot;</span>]][[<span class="st">&quot;lng&quot;</span>]])</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Append to full results dataframe.</span></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>  loc_coords <span class="sc">%&lt;&gt;%</span> <span class="fu">bind_rows</span>(clean_results)</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(results, clean_results, i, search_status)</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a><span class="co"># (1.4): Keep first result for each address.</span></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>clean_results <span class="sc">%&lt;&gt;%</span></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span></code></pre></div>
<p>Once you finish your set of Google Place API requests, you should save the results to a CSV file for later use. The search process is not perfectly replicable as identical searches can produce different results over time, so you should only run your full search loop once.</p>
<!--chapter:end:04-geo_data.Rmd-->
</div>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
