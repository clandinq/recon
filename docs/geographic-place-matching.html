<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Geographic place matching | R for Economists</title>
  <meta name="description" content="A short programming guide for economics research." />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Geographic place matching | R for Economists" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A short programming guide for economics research." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Geographic place matching | R for Economists" />
  
  <meta name="twitter:description" content="A short programming guide for economics research." />
  

<meta name="author" content="César Landín" />


<meta name="date" content="2023-07-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="statistical-tests.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R for Economists</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#contents"><i class="fa fa-check"></i><b>1.1</b> Contents</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="figures.html"><a href="figures.html"><i class="fa fa-check"></i><b>2</b> Figures</a>
<ul>
<li class="chapter" data-level="2.1" data-path="figures.html"><a href="figures.html#plot-margins"><i class="fa fa-check"></i><b>2.1</b> Plot margins</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="figures.html"><a href="figures.html#removing-white-space-around-the-plot"><i class="fa fa-check"></i><b>2.1.1</b> Removing white space around the plot</a></li>
<li class="chapter" data-level="2.1.2" data-path="figures.html"><a href="figures.html#removing-white-space-between-axes-and-plot"><i class="fa fa-check"></i><b>2.1.2</b> Removing white space between axes and plot</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="figures.html"><a href="figures.html#axis-labels"><i class="fa fa-check"></i><b>2.2</b> Axis labels</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="figures.html"><a href="figures.html#removing-axis-labels"><i class="fa fa-check"></i><b>2.2.1</b> Removing axis labels</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="figures.html"><a href="figures.html#legends"><i class="fa fa-check"></i><b>2.3</b> Legends</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="figures.html"><a href="figures.html#removing-the-legend-title"><i class="fa fa-check"></i><b>2.3.1</b> Removing the legend title</a></li>
<li class="chapter" data-level="2.3.2" data-path="figures.html"><a href="figures.html#removing-black-boxes-around-legend-keys"><i class="fa fa-check"></i><b>2.3.2</b> Removing black boxes around legend keys</a></li>
<li class="chapter" data-level="2.3.3" data-path="figures.html"><a href="figures.html#putting-the-legend-inside-the-figure"><i class="fa fa-check"></i><b>2.3.3</b> Putting the legend inside the figure</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="figures.html"><a href="figures.html#number-formatting-functions"><i class="fa fa-check"></i><b>2.4</b> Number formatting functions</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="figures.html"><a href="figures.html#calculating-the-mean-median-and-standard-deviation-of-a-variable"><i class="fa fa-check"></i><b>2.4.1</b> Calculating the mean, median and standard deviation of a variable</a></li>
<li class="chapter" data-level="2.4.2" data-path="figures.html"><a href="figures.html#checking-if-a-number-is-an-integer."><i class="fa fa-check"></i><b>2.4.2</b> Checking if a number is an integer.</a></li>
<li class="chapter" data-level="2.4.3" data-path="figures.html"><a href="figures.html#number-formatting-function"><i class="fa fa-check"></i><b>2.4.3</b> Number formatting function</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="figures.html"><a href="figures.html#multiplot-figures"><i class="fa fa-check"></i><b>2.5</b> Multiplot figures</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="figures.html"><a href="figures.html#auxiliary-functions-to-remove-figure-components-axes-legend"><i class="fa fa-check"></i><b>2.5.1</b> Auxiliary functions to remove figure components: axes, legend</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>3</b> Tables</a>
<ul>
<li class="chapter" data-level="3.1" data-path="tables.html"><a href="tables.html#guidelines-for-table-formatting"><i class="fa fa-check"></i><b>3.1</b> Guidelines for table formatting</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="tables.html"><a href="tables.html#horizontal-and-vertical-lines"><i class="fa fa-check"></i><b>3.1.1</b> Horizontal and vertical lines</a></li>
<li class="chapter" data-level="3.1.2" data-path="tables.html"><a href="tables.html#column-headings"><i class="fa fa-check"></i><b>3.1.2</b> Column headings</a></li>
<li class="chapter" data-level="3.1.3" data-path="tables.html"><a href="tables.html#symbols"><i class="fa fa-check"></i><b>3.1.3</b> Symbols</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="tables.html"><a href="tables.html#an-example-using-the-iris-dataset"><i class="fa fa-check"></i><b>3.2</b> An example using the <code>iris</code> dataset</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="tables.html"><a href="tables.html#two-simple-models-using-the-iris-dataset"><i class="fa fa-check"></i><b>3.2.1</b> Two simple models using the <code>iris</code> dataset</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="tables.html"><a href="tables.html#adjusting-table-size-and-position"><i class="fa fa-check"></i><b>3.3</b> Adjusting table size and position</a></li>
<li class="chapter" data-level="3.4" data-path="tables.html"><a href="tables.html#updating-variable-names-and-adding-a-caption-and-label"><i class="fa fa-check"></i><b>3.4</b> Updating variable names and adding a caption and label</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="tables.html"><a href="tables.html#updating-independent-variable-names"><i class="fa fa-check"></i><b>3.4.1</b> Updating independent variable names</a></li>
<li class="chapter" data-level="3.4.2" data-path="tables.html"><a href="tables.html#adding-dependent-variable-names-and-model-numbers"><i class="fa fa-check"></i><b>3.4.2</b> Adding dependent variable names and model numbers</a></li>
<li class="chapter" data-level="3.4.3" data-path="tables.html"><a href="tables.html#adding-a-multicolumn-title"><i class="fa fa-check"></i><b>3.4.3</b> Adding a multicolumn title</a></li>
<li class="chapter" data-level="3.4.4" data-path="tables.html"><a href="tables.html#adding-a-caption-and-title-to-the-table"><i class="fa fa-check"></i><b>3.4.4</b> Adding a caption and title to the table</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="tables.html"><a href="tables.html#final-table-formatting"><i class="fa fa-check"></i><b>3.5</b> Final table formatting</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="tables.html"><a href="tables.html#updating-the-number-of-observations"><i class="fa fa-check"></i><b>3.5.1</b> Updating the number of observations</a></li>
<li class="chapter" data-level="3.5.2" data-path="tables.html"><a href="tables.html#inserting-additional-data-rows"><i class="fa fa-check"></i><b>3.5.2</b> Inserting additional data rows</a></li>
<li class="chapter" data-level="3.5.3" data-path="tables.html"><a href="tables.html#distributing-coefficient-names-over-two-rows"><i class="fa fa-check"></i><b>3.5.3</b> Distributing coefficient names over two rows</a></li>
<li class="chapter" data-level="3.5.4" data-path="tables.html"><a href="tables.html#inserting-space-between-variables"><i class="fa fa-check"></i><b>3.5.4</b> Inserting space between variables</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="tables.html"><a href="tables.html#putting-it-all-together"><i class="fa fa-check"></i><b>3.6</b> Putting it all together</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="tables.html"><a href="tables.html#combining-everything-into-one-simple-function"><i class="fa fa-check"></i><b>3.6.1</b> Combining everything into one simple function</a></li>
<li class="chapter" data-level="3.6.2" data-path="tables.html"><a href="tables.html#adding-footnotes"><i class="fa fa-check"></i><b>3.6.2</b> Adding footnotes</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="tables.html"><a href="tables.html#preparing-tables-for-presentations"><i class="fa fa-check"></i><b>3.7</b> Preparing tables for presentations</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="tables.html"><a href="tables.html#generating-presentation-versions-of-tables"><i class="fa fa-check"></i><b>3.7.1</b> Generating presentation versions of tables</a></li>
<li class="chapter" data-level="3.7.2" data-path="tables.html"><a href="tables.html#removing-standard-errors-and-column-numbers"><i class="fa fa-check"></i><b>3.7.2</b> Removing standard errors and column numbers</a></li>
<li class="chapter" data-level="3.7.3" data-path="tables.html"><a href="tables.html#adding-notes"><i class="fa fa-check"></i><b>3.7.3</b> Adding notes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="statistical-tests.html"><a href="statistical-tests.html"><i class="fa fa-check"></i><b>4</b> Statistical tests</a>
<ul>
<li class="chapter" data-level="4.1" data-path="statistical-tests.html"><a href="statistical-tests.html#easy-two-sided-hypothesis-tests-in-r"><i class="fa fa-check"></i><b>4.1</b> Easy two-sided hypothesis tests in R</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="geographic-place-matching.html"><a href="geographic-place-matching.html"><i class="fa fa-check"></i><b>5</b> Geographic place matching</a>
<ul>
<li class="chapter" data-level="5.1" data-path="geographic-place-matching.html"><a href="geographic-place-matching.html#google-places-api-searches"><i class="fa fa-check"></i><b>5.1</b> Google Places API searches</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for Economists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="geographic-place-matching" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> Geographic place matching<a href="geographic-place-matching.html#geographic-place-matching" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In applied work, we often have to deal with observations that have an associated address or coordinates but no geographic codes. For cases in which no coordinates are available, one option is to match addresses to coordinates using Google Place API searches, and then merge the resulting coordinates with shapefiles to obtain geographic codes.</p>
<div id="google-places-api-searches" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Google Places API searches<a href="geographic-place-matching.html#google-places-api-searches" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>R package <code>googleway</code> makes it easy to perform Google Place API searches. <code>googleway::google_find_place</code> generates a <a href="https://developers.google.com/maps/documentation/places/web-service/search-find-place">Find Place request</a>, taking a text input and returning an array of place candidates, along with their corresponding search status. From this result, we can extract the address and coordinates.</p>
<p>Currently, you get $200 of Google Maps Platform usage every month for free. <a href="https://mapsplatform.google.com/pricing/">Each request costs $0.017</a>. While this may seem like little, generating 12,000 requests will already exceed the monthly free usage quota ($200 = 11,764.7 requests). It’s easy to exceed this number of requests when you’re running loops for large query vectors repeatedly. Therefore, the best practice is to start out with a small sample, ensure that searches are returning valid results, and then extend the method to the full sample. You can <a href="https://developers.google.com/maps/documentation/places/web-service/report-monitor#quotas">set a maximum quota</a> of 375 requests per day (375 x 31 = 11,625) to ensure you don’t exceed the monthly free usage limit.</p>
<p>To start using <code>googleway</code> to conduct Google Place API searches, you first need to <a href="https://developers.google.com/maps/documentation/places/web-service/cloud-setup">create a Google Cloud project</a> and <a href="https://developers.google.com/maps/documentation/places/web-service/get-api-key">set up an API key</a>. Once you have set this up, you can load <code>googleway</code>, define the API key and start conducting searches.
Here is a simple example of an individual query.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="geographic-place-matching.html#cb52-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(here, tidyverse, googleway)</span>
<span id="cb52-2"><a href="geographic-place-matching.html#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="geographic-place-matching.html#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co"># (1.1): Set Google Place search API key.</span></span>
<span id="cb52-4"><a href="geographic-place-matching.html#cb52-4" aria-hidden="true" tabindex="-1"></a>key <span class="ot">&lt;-</span> <span class="st">&quot;KJzaLyCLI-nXPsHqVwz-jna1HYg2jKpBueSsTWs&quot;</span> <span class="co"># insert API key here</span></span>
<span id="cb52-5"><a href="geographic-place-matching.html#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set_key</span>(key)</span>
<span id="cb52-6"><a href="geographic-place-matching.html#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="geographic-place-matching.html#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># (1.2): Define tibble with addresses to look up.</span></span>
<span id="cb52-8"><a href="geographic-place-matching.html#cb52-8" aria-hidden="true" tabindex="-1"></a>missing_locs <span class="ot">&lt;-</span> <span class="fu">tribble</span>(<span class="sc">~</span>id, <span class="sc">~</span>address,</span>
<span id="cb52-9"><a href="geographic-place-matching.html#cb52-9" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">1</span>, <span class="st">&quot;Av. Álvaro Obregón 225, Roma Norte, Cuauhtémoc, CDMX, Mexico&quot;</span>,</span>
<span id="cb52-10"><a href="geographic-place-matching.html#cb52-10" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">2</span>, <span class="st">&quot;Río Hondo #1, Col. Progreso Tizapán, Álvaro Obregón, CDMX, México&quot;</span>)</span>
<span id="cb52-11"><a href="geographic-place-matching.html#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="geographic-place-matching.html#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="co"># (1.3): Loop over missing addresses.</span></span>
<span id="cb52-13"><a href="geographic-place-matching.html#cb52-13" aria-hidden="true" tabindex="-1"></a>loc_coords <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb52-14"><a href="geographic-place-matching.html#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(missing_locs)) {     </span>
<span id="cb52-15"><a href="geographic-place-matching.html#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get results from Google Place search</span></span>
<span id="cb52-16"><a href="geographic-place-matching.html#cb52-16" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">google_find_place</span>(missing_locs<span class="sc">$</span>address[i], <span class="at">inputtype =</span> <span class="st">&quot;textquery&quot;</span>, <span class="at">language =</span> <span class="st">&quot;es&quot;</span>)</span>
<span id="cb52-17"><a href="geographic-place-matching.html#cb52-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-18"><a href="geographic-place-matching.html#cb52-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print results</span></span>
<span id="cb52-19"><a href="geographic-place-matching.html#cb52-19" aria-hidden="true" tabindex="-1"></a>  search_status <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(results[[<span class="st">&quot;status&quot;</span>]] <span class="sc">==</span> <span class="st">&quot;OK&quot;</span>, </span>
<span id="cb52-20"><a href="geographic-place-matching.html#cb52-20" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;search successful&quot;</span>, </span>
<span id="cb52-21"><a href="geographic-place-matching.html#cb52-21" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;search returned no results&quot;</span>)</span>
<span id="cb52-22"><a href="geographic-place-matching.html#cb52-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">str_c</span>(<span class="st">&quot;Working on address &quot;</span>, i, <span class="st">&quot; out of &quot;</span>, <span class="fu">nrow</span>(missing_locs), <span class="st">&quot;, &quot;</span>, search_status))</span>
<span id="cb52-23"><a href="geographic-place-matching.html#cb52-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-24"><a href="geographic-place-matching.html#cb52-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract formatted address and coordinates results</span></span>
<span id="cb52-25"><a href="geographic-place-matching.html#cb52-25" aria-hidden="true" tabindex="-1"></a>  clean_results <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id =</span> missing_locs<span class="sc">$</span>id[i],</span>
<span id="cb52-26"><a href="geographic-place-matching.html#cb52-26" aria-hidden="true" tabindex="-1"></a>                          <span class="at">address_clean =</span> results[[<span class="st">&quot;candidates&quot;</span>]][[<span class="st">&quot;formatted_address&quot;</span>]],</span>
<span id="cb52-27"><a href="geographic-place-matching.html#cb52-27" aria-hidden="true" tabindex="-1"></a>                          <span class="at">loc_lat =</span> results[[<span class="st">&quot;candidates&quot;</span>]][[<span class="st">&quot;geometry&quot;</span>]][[<span class="st">&quot;location&quot;</span>]][[<span class="st">&quot;lat&quot;</span>]],</span>
<span id="cb52-28"><a href="geographic-place-matching.html#cb52-28" aria-hidden="true" tabindex="-1"></a>                          <span class="at">loc_lon =</span> results[[<span class="st">&quot;candidates&quot;</span>]][[<span class="st">&quot;geometry&quot;</span>]][[<span class="st">&quot;location&quot;</span>]][[<span class="st">&quot;lng&quot;</span>]])</span>
<span id="cb52-29"><a href="geographic-place-matching.html#cb52-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-30"><a href="geographic-place-matching.html#cb52-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Append to full results dataframe.</span></span>
<span id="cb52-31"><a href="geographic-place-matching.html#cb52-31" aria-hidden="true" tabindex="-1"></a>  loc_coords <span class="sc">%&lt;&gt;%</span> <span class="fu">bind_rows</span>(clean_results)</span>
<span id="cb52-32"><a href="geographic-place-matching.html#cb52-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-33"><a href="geographic-place-matching.html#cb52-33" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(results, clean_results, i, search_status)</span>
<span id="cb52-34"><a href="geographic-place-matching.html#cb52-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-35"><a href="geographic-place-matching.html#cb52-35" aria-hidden="true" tabindex="-1"></a><span class="co"># (1.4): Keep first result for each address.</span></span>
<span id="cb52-36"><a href="geographic-place-matching.html#cb52-36" aria-hidden="true" tabindex="-1"></a>clean_results <span class="sc">%&lt;&gt;%</span></span>
<span id="cb52-37"><a href="geographic-place-matching.html#cb52-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb52-38"><a href="geographic-place-matching.html#cb52-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span></code></pre></div>
<p>Once you finish your set of Google Place API requests, you should save the results to a CSV file for later use. The search process is not perfectly replicable as identical searches can produce different results over time, so you should only run your full search loop once.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="statistical-tests.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/04-geo_data.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
